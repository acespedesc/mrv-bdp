import{a as Fe,b as Se,c as Rt}from"./chunk-CIEJV65P.js";import{a as ue,b as Mt}from"./chunk-C5UTVSEF.js";import"./chunk-FK6H3RFT.js";import{a as Ot,b as Tt}from"./chunk-DOPYPM73.js";import{b as Nt}from"./chunk-CK5U46UF.js";import{a as we}from"./chunk-XC25IVD2.js";import{a as mt}from"./chunk-RWZV4OPL.js";import{a as ut,b as gt,c as _t,d as ft,e as ht,f as vt,g as bt,h as Ct,i as yt,j as xt,k as Et,l as wt,n as ke,o as Ft,p as St,q as It}from"./chunk-XBSZIRZA.js";import{a as qe}from"./chunk-IXGIIPBD.js";import{a as st,b as $,c as b,e as W,f as ie,h as c,i as dt,j as re,k as ne,l as ct,m as ae,n as xe,o as Ee,p as le,q as se,r as de,s as ce,t as pe,u as pt,v as me,w as je,x as K}from"./chunk-B4EPVZF2.js";import"./chunk-IX6G3U3V.js";import"./chunk-35W2KPSY.js";import{a as Ae,h as lt}from"./chunk-OGI2M7DR.js";import{k as te,l as oe,m as z,o as Ke,p as U}from"./chunk-6XSUGG7T.js";import{$ as h,$b as k,Ab as f,Bb as Z,Cb as ee,Eb as R,Jb as v,Kb as S,Ob as Xe,Pb as Ze,Qb as et,Ra as We,Ta as Je,Ub as l,V as Re,Va as s,Wa as B,Wb as E,Xb as tt,Yb as ot,Zb as it,_b as rt,ac as nt,bc as C,da as q,gb as Ye,ja as De,la as X,lc as at,ma as w,mb as m,na as F,oa as Ue,ob as d,pa as $e,tb as ye,ua as H,yb as r,zb as i}from"./chunk-XFA5AQSA.js";import"./chunk-TSRGIXR5.js";var V=class n{ecoeficiencias=Ye([]);_http=h(Ae);_endPoint=je.apiUrl;_injector=h(De);crearEconomiaCircular(e){return this._http.post(`${this._endPoint}/cir`,e)}getEconomiaCircular(){return this._http.get(`${this._endPoint}/cir`)}getEcoCircularById(e){return console.log(e),this._http.get(`${this._endPoint}/cir/`+e)}eliminaEcoCircular(e){return this._http.delete(`${this._endPoint}/cir/`+e)}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Re({token:n,factory:n.\u0275fac,providedIn:"root"})};var Q=class n{_http=h(Ae);_endPoint=je.apiUrl;_injector=h(De);crearDocumentoAuxCal(e,o,t){let a=new FormData;return a.append("nombre",e),a.append("contenido",o),a.append("ecoCircularId",t.toString()),this._http.post(`${this._endPoint}/doc`,a)}getDocumentoAuxCal(e){return this._http.get(`${this._endPoint}/doc/`+e)}static \u0275fac=function(o){return new(o||n)};static \u0275prov=Re({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ie=n=>({"border-red-500":n});function Dt(n,e){n&1&&(r(0,"span",5),l(1,"*"),i())}function At(n,e){if(n&1&&(r(0,"option",32),l(1),i()),n&2){let o=e.$implicit;d("value",o.value),s(),E(" ",o.name," ")}}function jt(n,e){n&1&&(r(0,"div",33),l(1," * "),i())}function qt(n,e){if(n&1&&(r(0,"option",32),l(1),i()),n&2){let o=e.$implicit;d("value",o.value),s(),E(" ",o.name," ")}}function kt(n,e){n&1&&(r(0,"div",33),l(1," * "),i())}function Vt(n,e){n&1&&(r(0,"div",33),l(1," * "),i())}function Pt(n,e){if(n&1){let o=R();r(0,"tr",21)(1,"td",22)(2,"div",23)(3,"select",24),v("change",function(a){let p=w(o).index,g=S();return F(g.onTipoResiduoChange(a,p))}),r(4,"option",25),l(5,"Seleccione la clase"),i(),m(6,At,2,2,"option",26),i(),r(7,"label",27),l(8," Clase de Residuo "),i(),m(9,jt,2,0,"div",15),i()(),r(10,"td",22)(11,"div",23)(12,"select",28)(13,"option",25),l(14,"Seleccione Tipo Residuo"),i(),m(15,qt,2,2,"option",26),i(),r(16,"label",29),l(17," Tipo de Residuo "),i(),m(18,kt,2,0,"div",15),i()(),r(19,"td",22)(20,"div",23),f(21,"input",30),r(22,"label",31),l(23,"Cantidad Residuo"),i(),m(24,Vt,2,0,"div",15),i()()()}if(n&2){let o,t,a,p,g,u,x=e.index,_=S();d("formGroupName",x),s(3),d("ngClass",C(9,Ie,((o=_.dataForm.get("clase"))==null?null:o.hasError("required"))&&((o=_.dataForm.get("clase"))==null?null:o.touched))),s(3),d("ngForOf",_.residuoList),s(3),d("ngIf",((t=_.dataForm.get("clase"))==null?null:t.hasError("required"))&&((t=_.dataForm.get("clase"))==null?null:t.touched)),s(3),d("ngClass",C(11,Ie,((a=_.dataForm.get("fac_emi_tipo_res"))==null?null:a.hasError("required"))&&((a=_.dataForm.get("fac_emi_tipo_res"))==null?null:a.touched))),s(3),d("ngForOf",_.facEmiTipoResList[x]),s(3),d("ngIf",((p=_.dataForm.get("fac_emi_tipo_res"))==null?null:p.hasError("required"))&&((p=_.dataForm.get("fac_emi_tipo_res"))==null?null:p.touched)),s(3),d("ngClass",C(13,Ie,((g=_.dataForm.get("ctd_residuo"))==null?null:g.hasError("required"))&&((g=_.dataForm.get("ctd_residuo"))==null?null:g.touched))),s(3),d("ngIf",((u=_.dataForm.get("ctd_residuo"))==null?null:u.hasError("required"))&&((u=_.dataForm.get("ctd_residuo"))==null?null:u.touched))}}function Lt(n,e){n&1&&(r(0,"div",33),l(1," * "),i())}function Gt(n,e){n&1&&(r(0,"div",33),l(1," * "),i())}var Ve=class n{constructor(e){this.fb=e;this.dataForm=this.fb.group({usuarioId:new c(0),regionId:new c(0),agenciaId:new c(0),nro_solicitud:new c(""),respaldo:new c(""),caedecId:new c(0),objetivo_operacion:new c(0),destino_cap_inv_ope:new c(0),tipo_empresa:new c(0),ctd_empleos_gen:new c(0),monto_credito_mn:new c(0),monto_credito_me:new c(0),ctd_residuos_rec:new c(0),emision_gei_evi:new c(0),clase:new c(""),fac_emi_tipo_res:new c(""),ctd_residuo:new c(""),ctd_res_ceciclaods_ton:new c({value:"",disabled:!0},[b.required]),emi_gei_evi:new c({value:"",disabled:!0},[b.required]),contenido:new c("",[b.required]),residuos:this.fb.array([])})}onCloseModalCO=new H;dataOds=null;regionId;agenciaId;nroSolicitud;caedecId;respaldo;objetivoOperacion;destinoCapInvOpe;tipoEmpresa;cantidadEmpleosGen;montoCreditoMn;montoCreditoMe;dataForm;residuoService=h(Fe);fetrService=h(Se);toastr=h(K);residuoList=[];facEmiTipoResList=[];authService=h(we);ecoCirService=h(V);odsService=h(ue);maxRows=5;ducService=h(Q);selectedFile=null;fileName=null;docAuxCal;get residuos(){return this.dataForm.get("residuos")}ngOnChanges(){this.authService.userId$.subscribe(e=>{this.dataForm.patchValue({usuarioId:parseInt(e[0])})})}ngOnInit(){this.initializeResiduos(),this.getResiduos(),this.subscribeResiduosChanges()}subscribeResiduosChanges(){this.dataForm.get("residuos").controls.forEach(o=>{o.get("ctd_residuo")?.valueChanges.subscribe(()=>{this.updateCtdResCeciclaodsTon()}),o.get("fac_emi_tipo_res")?.valueChanges.subscribe(()=>{this.updateCtdResCeciclaodsTon()})})}updateCtdResCeciclaodsTon(){let e=this.calculoTotalCantidad();this.dataForm.get("ctd_res_ceciclaods_ton")?.setValue(e);let o=this.calculoTotal();this.dataForm.get("emi_gei_evi")?.setValue(o)}getResiduos(){this.residuoService.getResiduo().subscribe({next:e=>{console.log(e),this.residuoList=e.map(o=>({value:o.id,name:o.clase}))},error:()=>{this.toastr.error("Error al cargar las subcategor\xEDas")}})}initializeResiduos(){let e=this.dataForm.get("residuos");e.clear();for(let o=0;o<this.maxRows;o++)e.push(this.fb.group({clase:["",b.required],fac_emi_tipo_res:["",b.required],ctd_residuo:["",[b.required,b.min(0)]]})),this.facEmiTipoResList.push([])}onSubmit(){if(!this.validateResiduos()){this.toastr.error("Debes seleccionar al menos un residuo y asegurarte de que su cantidad sea mayor a cero.");return}this.dataForm.patchValue({regionId:this.regionId,agenciaId:this.agenciaId,nro_solicitud:this.nroSolicitud,respaldo:this.respaldo,caedecId:this.caedecId,objetivo_operacion:this.objetivoOperacion,destino_cap_inv_ope:this.destinoCapInvOpe,tipo_empresa:this.tipoEmpresa,ctd_empleos_gen:this.cantidadEmpleosGen,monto_credito_mn:this.montoCreditoMn,monto_credito_me:this.montoCreditoMe,ctd_residuos_rec:this.dataForm.get("ctd_res_ceciclaods_ton")?.value,emision_gei_evi:this.dataForm.get("emi_gei_evi")?.value}),console.log(this.dataForm.value),this.ecoCirService.crearEconomiaCircular(this.dataForm.value).subscribe({next:e=>{this.resetForm(),this.toastr.success("Registrado con exito!"),this.dataOds.ecoCircularId=e,console.log(this.dataOds),this.odsService.crearOds(this.dataOds).subscribe({next:()=>{this.toastr.success("ODS Registrados")}}),this.selectedFile&&this.ducService.crearDocumentoAuxCal(this.fileName,this.selectedFile,e).subscribe({next:()=>{this.toastr.success("Doc. calculos auxiliares guardados")}})},error:e=>{console.error("Error al actualizar Ecoeficiencia:",e),this.toastr.error("No se pudo registrar Ecoeficiencia. Int\xE9ntelo nuevamente m\xE1s tarde.")}})}resetForm(){this.dataForm.reset(),this.initializeResiduos(),this.onClose()}onClose(){this.dataForm.reset(),this.initializeResiduos(),this.onCloseModalCO.emit(!1)}onTipoResiduoChange(e,o){let a=+e.target.value;a?this.getFacEmiTipoRes(a,o):this.facEmiTipoResList[o]=[]}getFacEmiTipoRes(e,o){this.fetrService.getFacEmiTipoResiduo(e).subscribe({next:t=>{this.facEmiTipoResList[o]=t.map(a=>({value:a.valor,name:a.nombre}))},error:()=>{this.toastr.error("Error al cargar fac. emi tipo residuo")}})}calculoTotalCantidad(){let e=this.dataForm.get("residuos"),o=0,t=0;return e.controls.forEach(a=>{let p=a.get("ctd_residuo")?.value,g=a.get("fac_emi_tipo_res")?.value;p&&(o+=Number(p))}),o}calculoTotal(){let e=this.dataForm.get("residuos"),o=0;return e.controls.forEach(t=>{let a=t.get("ctd_residuo")?.value,p=t.get("fac_emi_tipo_res")?.value;a&&(o+=Number(a)*Number(p))}),o}validateResiduos(){return this.dataForm.get("residuos").controls.some(o=>{let t=o.get("ctd_residuo")?.value;return o.get("fac_emi_tipo_res")?.value&&t>0})}onFileSelected(e){let o=e.target;if(o.files&&o.files.length>0){let t=o.files[0];if(t.type==="application/pdf"){this.fileName=t.name;let a=new FileReader;a.onload=()=>{this.selectedFile=new Blob([a.result],{type:t.type}),console.log("Archivo convertido a Blob:",this.selectedFile)},a.readAsArrayBuffer(t)}else this.fileName=null,this.dataForm.get("contenido")?.setErrors({invalidFileType:!0})}}static \u0275fac=function(o){return new(o||n)(B(pe))};static \u0275cmp=q({type:n,selectors:[["app-capital-operacion"]],inputs:{dataOds:"dataOds",regionId:"regionId",agenciaId:"agenciaId",nroSolicitud:"nroSolicitud",caedecId:"caedecId",respaldo:"respaldo",objetivoOperacion:"objetivoOperacion",destinoCapInvOpe:"destinoCapInvOpe",tipoEmpresa:"tipoEmpresa",cantidadEmpleosGen:"cantidadEmpleosGen",montoCreditoMn:"montoCreditoMn",montoCreditoMe:"montoCreditoMe"},outputs:{onCloseModalCO:"onCloseModalCO"},standalone:!0,features:[X,k],decls:36,vars:11,consts:[["contenidoInput",""],[1,"mb-5","text-lg","font-bold","tracking-tight","text-gray-900","dark:text-white"],[1,"w-full",3,"ngSubmit","formGroup"],["for","contenido",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],[1,"mb-5","flex","items-center"],[1,"form-error","text-red-500"],["type","file","id","contenido","accept",".pdf",1,"form-control","mr-2",3,"change"],[1,"min-w-full","bg-gray","border","border-gray-300"],[1,"py-2","px-4","border-b"],["formArrayName","residuos"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-4"],[1,"relative","mt-6","flex","items-center"],["type","number","name","ctd_res_ceciclaods_ton","id","ctd_res_ceciclaods_ton","placeholder","ctd_res_ceciclaods_ton","formControlName","ctd_res_ceciclaods_ton","autocomplete","NA","step","0.01",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","ctd_res_ceciclaods_ton",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["class","absolute -right-4 text-red-500",4,"ngIf"],["type","number","name","emi_gei_evi","id","emi_gei_evi","placeholder","emi_gei_evi","formControlName","emi_gei_evi","autocomplete","NA","step","0.01",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","emi_gei_evi",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],[1,"my-5"],["type","submit",1,"text-white","bg-blue-600","hover:bg-blue-700","font-medium","rounded-lg","w-full","sm:w-auto","px-5","py-2.5","text-center"],["type","button",1,"text-white","ms-2","bg-gray-700","hover:bg-gray-800","font-medium","rounded-lg","w-full","sm:w-auto","px-5","py-2.5","text-center",3,"click"],[3,"formGroupName"],[1,"py-1","px-4","border-b"],[1,"relative","mt-1","flex","items-center"],["id","clase","formControlName","clase","autocomplete","NA",1,"peer","mt-1","w-64","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"change","ngClass"],["value","","selected",""],[3,"value",4,"ngFor","ngForOf"],["for","clase",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["id","fac_emi_tipo_res","formControlName","fac_emi_tipo_res","autocomplete","NA",1,"peer","mt-1","w-64","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","fac_emi_tipo_res",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["type","number","name","ctd_residuo","id","ctd_residuo","placeholder","ctd_residuo","formControlName","ctd_residuo","autocomplete","NA","step","0.01",1,"peer","mt-1","w-64","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","ctd_residuo",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],[3,"value"],[1,"absolute","-right-4","text-red-500"]],template:function(o,t){if(o&1){let a=R();r(0,"h5",1),l(1,"Tabla de Cantidad de residuos Capital de Operaci\xF3n (KO)"),i(),r(2,"form",2),v("ngSubmit",function(){return w(a),F(t.onSubmit())}),r(3,"label",3),l(4,"Adjuntar Documento de calculo aux."),i(),r(5,"div",4),m(6,Dt,2,0,"span",5),r(7,"input",6,0),v("change",function(g){return w(a),F(t.onFileSelected(g))}),i()(),r(9,"table",7)(10,"thead")(11,"tr")(12,"th",8),l(13,"Clase de Residuos"),i(),r(14,"th",8),l(15,"Tipo de Residuos"),i(),r(16,"th",8),l(17,"Cantidad de Residuos"),i()()(),r(18,"tbody",9),m(19,Pt,25,15,"tr",10),i()(),r(20,"div",11)(21,"div",12),f(22,"input",13),r(23,"label",14),l(24," Cantidad de residuos reciclados (t) "),i(),m(25,Lt,2,0,"div",15),i(),r(26,"div",12),f(27,"input",16),r(28,"label",17),l(29," Emisiones de GEI evitadas (t CO2eq) "),i(),m(30,Gt,2,0,"div",15),i()(),r(31,"div",18)(32,"button",19),l(33,"Confirmar"),i(),r(34,"button",20),v("click",function(){return w(a),F(t.onClose())}),l(35,"Cancel"),i()()()}if(o&2){let a,p,g,u,x;s(2),d("formGroup",t.dataForm),s(4),ye((a=t.dataForm.get("contenido"))!=null&&a.hasError("required")&&((a=t.dataForm.get("contenido"))!=null&&a.touched)?6:-1),s(13),d("ngForOf",t.residuos.controls),s(3),d("ngClass",C(7,Ie,((p=t.dataForm.get("ctd_res_ceciclaods_ton"))==null?null:p.hasError("required"))&&((p=t.dataForm.get("ctd_res_ceciclaods_ton"))==null?null:p.touched))),s(3),d("ngIf",((g=t.dataForm.get("ctd_res_ceciclaods_ton"))==null?null:g.hasError("required"))&&((g=t.dataForm.get("ctd_res_ceciclaods_ton"))==null?null:g.touched)),s(2),d("ngClass",C(9,Ie,((u=t.dataForm.get("emi_gei_evi"))==null?null:u.hasError("required"))&&((u=t.dataForm.get("emi_gei_evi"))==null?null:u.touched))),s(3),d("ngIf",((x=t.dataForm.get("emi_gei_evi"))==null?null:x.hasError("required"))&&((x=t.dataForm.get("emi_gei_evi"))==null?null:x.touched))}},dependencies:[U,te,oe,z,me,re,de,ce,$,ne,se,W,ie,ae,le,xe,Ee]})};var fe=n=>({"border-red-500":n});function Bt(n,e){if(n&1&&(r(0,"option",26),l(1),i()),n&2){let o=e.$implicit;d("value",o.value),s(),E(" ",o.name," ")}}function Ht(n,e){n&1&&(r(0,"div",27),l(1," * "),i())}function zt(n,e){n&1&&(r(0,"span",11),l(1,"*"),i())}function Ut(n,e){if(n&1&&(r(0,"option",26),l(1),i()),n&2){let o=e.$implicit;d("value",o.value),s(),E(" ",o.name," ")}}function $t(n,e){n&1&&(r(0,"div",27),l(1," * "),i())}function Wt(n,e){if(n&1&&(r(0,"option",26),l(1),i()),n&2){let o=e.$implicit;d("value",o.value),s(),E(" ",o.name," ")}}function Kt(n,e){n&1&&(r(0,"div",27),l(1," * "),i())}function Qt(n,e){if(n&1&&(r(0,"option",26),l(1),i()),n&2){let o=e.$implicit;d("value",o.value),s(),E(" ",o.name," ")}}function Jt(n,e){n&1&&(r(0,"div",27),l(1," * "),i())}function Yt(n,e){n&1&&(r(0,"div",27),l(1," * "),i())}function Xt(n,e){if(n&1){let o=R();r(0,"tr",28)(1,"td",29)(2,"div",4)(3,"select",30),v("change",function(a){let p=w(o).index,g=S();return F(g.onTipoResiduoChange(a,p))}),r(4,"option",31),l(5,"Seleccione la clase"),i(),m(6,Ut,2,2,"option",6),i(),r(7,"label",32),l(8," Clase de Residuo "),i(),m(9,$t,2,0,"div",8),i()(),r(10,"td",29)(11,"div",4)(12,"select",33)(13,"option",31),l(14,"Seleccione Tipo Residuo"),i(),m(15,Wt,2,2,"option",6),i(),r(16,"label",34),l(17," Tipo de Residuo "),i(),m(18,Kt,2,0,"div",8),i()(),r(19,"td",29)(20,"div",4)(21,"select",35)(22,"option",31),l(23,"Seleccione Tecnologia"),i(),m(24,Qt,2,2,"option",6),i(),r(25,"label",36),l(26," Tipo de Tecnologia "),i(),m(27,Jt,2,0,"div",8),i()(),r(28,"td",29)(29,"div",4),f(30,"input",37),r(31,"label",38),l(32,"Cantidad Residuo"),i(),m(33,Yt,2,0,"div",8),i()()()}if(n&2){let o,t,a,p,g,u,x,_,O=e.index,y=S();d("formGroupName",O),s(3),d("ngClass",C(12,fe,((o=y.dataForm.get("clase"))==null?null:o.hasError("required"))&&((o=y.dataForm.get("clase"))==null?null:o.touched))),s(3),d("ngForOf",y.residuoList),s(3),d("ngIf",((t=y.dataForm.get("clase"))==null?null:t.hasError("required"))&&((t=y.dataForm.get("clase"))==null?null:t.touched)),s(3),d("ngClass",C(14,fe,((a=y.dataForm.get("fac_emi_tipo_res"))==null?null:a.hasError("required"))&&((a=y.dataForm.get("fac_emi_tipo_res"))==null?null:a.touched))),s(3),d("ngForOf",y.facEmiTipoResList[O]),s(3),d("ngIf",((p=y.dataForm.get("fac_emi_tipo_res"))==null?null:p.hasError("required"))&&((p=y.dataForm.get("fac_emi_tipo_res"))==null?null:p.touched)),s(3),d("ngClass",C(16,fe,((g=y.dataForm.get("tipo_tegnologia"))==null?null:g.hasError("required"))&&((g=y.dataForm.get("tipo_tegnologia"))==null?null:g.touched))),s(3),d("ngForOf",y.tipoTecnologiaList[O]),s(3),d("ngIf",((u=y.dataForm.get("tipo_tegnologia"))==null?null:u.hasError("required"))&&((u=y.dataForm.get("tipo_tegnologia"))==null?null:u.touched)),s(3),d("ngClass",C(18,fe,((x=y.dataForm.get("ctd_residuo"))==null?null:x.hasError("required"))&&((x=y.dataForm.get("ctd_residuo"))==null?null:x.touched))),s(3),d("ngIf",((_=y.dataForm.get("ctd_residuo"))==null?null:_.hasError("required"))&&((_=y.dataForm.get("ctd_residuo"))==null?null:_.touched))}}function Zt(n,e){n&1&&(r(0,"div",27),l(1," * "),i())}function eo(n,e){n&1&&(r(0,"div",27),l(1," * "),i())}var Ge=class n{constructor(e){this.fb=e;this.dataForm=this.fb.group({usuarioId:new c(0),regionId:new c(0),agenciaId:new c(0),nro_solicitud:new c(""),respaldo:new c(""),caedecId:new c(0),objetivo_operacion:new c(0),tipos_tecnologia:new c(0),metodo_estimacion:new c(0),destino_cap_inv_ope:new c(0),tipo_empresa:new c(0),ctd_empleos_gen:new c(0),monto_credito_mn:new c(0),monto_credito_me:new c(0),ctd_residuos_rec:new c(0),emision_gei_evi:new c(0),metodo_est:new c("",[b.required]),clase:new c(""),fac_emi_tipo_res:new c(""),tipo_tegnologia:new c(""),ctd_residuo:new c(""),contenido:new c("",[b.required]),residuos:this.fb.array([]),ctd_res_ceciclaods_ton:new c({value:"",disabled:!0},[b.required]),emi_gei_evi:new c({value:"",disabled:!0},[b.required])})}onCloseModalCI=new H;dataForm;residuoService=h(Fe);authService=h(we);ecoCirService=h(V);dataOds=null;regionId;agenciaId;nroSolicitud;caedecId;respaldo;objetivoOperacion;destinoCapInvOpe;tipoEmpresa;cantidadEmpleosGen;montoCreditoMn;montoCreditoMe;ducService=h(Q);selectedFile=null;fileName=null;docAuxCal;fetrService=h(Se);maquinaReciclajeService=h(Rt);toastr=h(K);odsService=h(ue);residuoList=[];facEmiTipoResList=[];tipoTecnologiaList=[];tipoTecnologiaListaux=[];maxRows=3;metodoEstimacionList=[{value:"",name:"Seleccione estimaci\xF3n"},{value:"Considerando la capacidad de producci\xF3n",name:"Considerando la capacidad de producci\xF3n"},{value:"Considerando Incremento en el patrimonio",name:"Considerando Incremento en el patrimonio"}];ngOnChanges(){this.authService.userId$.subscribe(e=>{this.dataForm.patchValue({usuarioId:parseInt(e[0])})})}validateResiduos(){return this.dataForm.get("residuos").controls.some(o=>{let t=o.get("ctd_residuo")?.value;return o.get("fac_emi_tipo_res")?.value&&t>0})}get residuos(){return this.dataForm.get("residuos")}ngOnInit(){this.initializeResiduos(),this.getResiduos(),this.subscribeResiduosChanges()}subscribeResiduosChanges(){this.dataForm.get("residuos").controls.forEach(o=>{o.get("ctd_residuo")?.valueChanges.subscribe(()=>{this.updateCtdResCeciclaodsTon()}),o.get("fac_emi_tipo_res")?.valueChanges.subscribe(()=>{this.updateCtdResCeciclaodsTon()})})}updateCtdResCeciclaodsTon(){let e=this.calculoTotalCantidad();this.dataForm.get("ctd_res_ceciclaods_ton")?.setValue(e);let o=this.calculoTotal();this.dataForm.get("emi_gei_evi")?.setValue(o)}calculoTotal(){let e=this.dataForm.get("residuos"),o=0;return e.controls.forEach(t=>{let a=t.get("ctd_residuo")?.value,p=t.get("fac_emi_tipo_res")?.value;a&&(o+=Number(a)*Number(p))}),o}calculoTotalCantidad(){let e=this.dataForm.get("residuos"),o=0;return e.controls.forEach(t=>{let a=t.get("ctd_residuo")?.value;a&&(o+=Number(a))}),o}getConcatenatedTecnologias(){return this.dataForm.get("residuos").controls.map(t=>{let a=t.get("tipo_tegnologia")?.value;console.log(a);let p=this.tipoTecnologiaListaux.flat().find(g=>g.value===Number(a));return p?p.name:""}).filter(t=>t).join("-")}getResiduos(){this.residuoService.getResiduo().subscribe({next:e=>{console.log(e),this.residuoList=e.map(o=>({value:o.id,name:o.clase}))},error:()=>{this.toastr.error("Error al cargar las subcategor\xEDas")}})}initializeResiduos(){let e=this.dataForm.get("residuos");e.clear();for(let o=0;o<this.maxRows;o++)e.push(this.fb.group({clase:["",b.required],fac_emi_tipo_res:["",b.required],tipo_tegnologia:["",b.required],ctd_residuo:["",[b.required,b.min(0)]]})),this.facEmiTipoResList.push([]),this.tipoTecnologiaList.push([])}onTipoResiduoChange(e,o){let a=+e.target.value;a?(this.getFacEmiTipoRes(a,o),this.getMaquinaReciclaje(a,o)):(this.facEmiTipoResList[o]=[],this.tipoTecnologiaList[o]=[])}getFacEmiTipoRes(e,o){this.fetrService.getFacEmiTipoResiduo(e).subscribe({next:t=>{this.facEmiTipoResList[o]=t.map(a=>({value:a.valor,name:a.nombre}))},error:()=>{this.toastr.error("Error al cargar fac. emi tipo residuo")}})}getMaquinaReciclaje(e,o){this.maquinaReciclajeService.getMaquinariaReciclaje(e).subscribe({next:t=>{this.tipoTecnologiaList[o]=t.map(a=>({value:a.id,name:a.nombre})),this.tipoTecnologiaListaux=this.tipoTecnologiaList.flat(),console.log(this.tipoTecnologiaList[o])},error:()=>{this.toastr.error("Error al maquinaria de reciclaje")}})}onSubmit(){if(!this.validateResiduos()){this.toastr.error("Debes seleccionar al menos un residuo y asegurarte de que su cantidad sea mayor a cero.");return}console.log(this.getConcatenatedTecnologias()),this.dataForm.patchValue({regionId:this.regionId,agenciaId:this.agenciaId,nro_solicitud:this.nroSolicitud,respaldo:this.respaldo,caedecId:this.caedecId,objetivo_operacion:this.objetivoOperacion,tipos_tecnologia:this.getConcatenatedTecnologias(),metodo_estimacion:this.dataForm.get("metodo_est")?.value,destino_cap_inv_ope:this.destinoCapInvOpe,tipo_empresa:this.tipoEmpresa,ctd_empleos_gen:this.cantidadEmpleosGen,monto_credito_mn:this.montoCreditoMn,monto_credito_me:this.montoCreditoMe,ctd_residuos_rec:this.dataForm.get("ctd_res_ceciclaods_ton")?.value,emision_gei_evi:this.dataForm.get("emi_gei_evi")?.value}),console.log(this.dataForm.value),this.ecoCirService.crearEconomiaCircular(this.dataForm.value).subscribe({next:e=>{this.resetForm(),this.toastr.success("Registrado con exito!"),this.dataOds.ecoCircularId=e,console.log(this.dataOds),this.odsService.crearOds(this.dataOds).subscribe({next:()=>{this.toastr.success("ODS Registrados")}}),this.selectedFile&&this.ducService.crearDocumentoAuxCal(this.fileName,this.selectedFile,e).subscribe({next:()=>{this.toastr.success("Doc. calculos auxiliares guardados")}})},error:e=>{console.error("Error al actualizar Ecoeficiencia:",e),this.toastr.error("No se pudo registrar Ecoeficiencia. Int\xE9ntelo nuevamente m\xE1s tarde.")}})}onFileSelected(e){let o=e.target;if(o.files&&o.files.length>0){let t=o.files[0];if(t.type==="application/pdf"){this.fileName=t.name;let a=new FileReader;a.onload=()=>{this.selectedFile=new Blob([a.result],{type:t.type}),console.log("Archivo convertido a Blob:",this.selectedFile)},a.readAsArrayBuffer(t)}else this.fileName=null,this.dataForm.get("contenido")?.setErrors({invalidFileType:!0})}}onClose(){this.dataForm.reset({metodo_est:""}),this.initializeResiduos(),this.onCloseModalCI.emit(!1)}resetForm(){this.onClose()}static \u0275fac=function(o){return new(o||n)(B(pe))};static \u0275cmp=q({type:n,selectors:[["app-capital-inversion"]],inputs:{dataOds:"dataOds",regionId:"regionId",agenciaId:"agenciaId",nroSolicitud:"nroSolicitud",caedecId:"caedecId",respaldo:"respaldo",objetivoOperacion:"objetivoOperacion",destinoCapInvOpe:"destinoCapInvOpe",tipoEmpresa:"tipoEmpresa",cantidadEmpleosGen:"cantidadEmpleosGen",montoCreditoMn:"montoCreditoMn",montoCreditoMe:"montoCreditoMe"},outputs:{onCloseModalCI:"onCloseModalCI"},standalone:!0,features:[X,k],decls:46,vars:16,consts:[["contenidoInput",""],[1,"mb-5","text-lg","font-bold","tracking-tight","text-gray-900","dark:text-white"],[1,"w-full",3,"ngSubmit","formGroup"],[1,"border","rounded-lg","p-4","bg-gray","shadow-md"],[1,"relative","mt-1","flex","items-center"],["id","metodo_est","formControlName","metodo_est","autocomplete","NA",1,"peer","mt-1","w-96","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-gray","rounded-md","text-sm",3,"ngClass"],[3,"value",4,"ngFor","ngForOf"],["for","metodo_est",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["class","absolute -right-4 text-red-500",4,"ngIf"],["for","contenido",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],[1,"mb-5","flex","items-center"],[1,"form-error","text-red-500"],["type","file","id","contenido","accept",".pdf","formControlName","contenido",1,"form-control","mr-2",3,"change"],[1,"min-w-full","bg-gray","border","border-gray-300"],[1,"py-2","px-4","border-b"],["formArrayName","residuos"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-4"],[1,"relative","mt-6","flex","items-center"],["type","number","name","ctd_res_ceciclaods_ton","id","ctd_res_ceciclaods_ton","placeholder","ctd_res_ceciclaods_ton","formControlName","ctd_res_ceciclaods_ton","autocomplete","NA","step","0.01",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","ctd_res_ceciclaods_ton",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["type","number","name","emi_gei_evi","id","emi_gei_evi","placeholder","emi_gei_evi","formControlName","emi_gei_evi","autocomplete","NA","step","0.01",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","emi_gei_evi",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],[1,"my-5"],["type","submit",1,"text-white","bg-blue-600","hover:bg-blue-700","font-medium","rounded-lg","w-full","sm:w-auto","px-5","py-2.5","text-center"],["type","button",1,"text-white","ms-2","bg-gray-700","hover:bg-gray-800","font-medium","rounded-lg","w-full","sm:w-auto","px-5","py-2.5","text-center",3,"click"],[3,"value"],[1,"absolute","-right-4","text-red-500"],[3,"formGroupName"],[1,"py-1","px-4","border-b"],["id","clase","formControlName","clase","autocomplete","NA",1,"peer","mt-1","w-64","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"change","ngClass"],["value","","selected",""],["for","clase",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["id","fac_emi_tipo_res","formControlName","fac_emi_tipo_res","autocomplete","NA",1,"peer","mt-1","w-64","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","fac_emi_tipo_res",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["id","tipo_tegnologia","formControlName","tipo_tegnologia","autocomplete","NA",1,"peer","mt-1","w-64","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","tipo_tegnologia",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["type","number","name","ctd_residuo","id","ctd_residuo","placeholder","ctd_residuo","formControlName","ctd_residuo","autocomplete","NA","step","0.01",1,"peer","mt-1","w-64","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","ctd_residuo",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"]],template:function(o,t){if(o&1){let a=R();r(0,"h5",1),l(1,"Tabla de Cantidad de residuos Capital de Inversi\xF3n(KI)"),i(),r(2,"form",2),v("ngSubmit",function(){return w(a),F(t.onSubmit())}),r(3,"div",3)(4,"div",4)(5,"select",5),m(6,Bt,2,2,"option",6),i(),r(7,"label",7),l(8," Elija el metodo de estimaci\xF3n "),i(),m(9,Ht,2,0,"div",8),i(),r(10,"div",4)(11,"label",9),l(12,"Adjuntar Documento de calculo aux."),i(),r(13,"div",10),m(14,zt,2,0,"span",11),r(15,"input",12,0),v("change",function(g){return w(a),F(t.onFileSelected(g))}),i()()()(),r(17,"table",13)(18,"thead")(19,"tr")(20,"th",14),l(21,"Clase de Residuos"),i(),r(22,"th",14),l(23,"Tipo de Residuos"),i(),r(24,"th",14),l(25,"Tipo de Tecnologia"),i(),r(26,"th",14),l(27,"Cantidad de Residuos(t/a\xF1o)"),i()()(),r(28,"tbody",15),m(29,Xt,34,20,"tr",16),i()(),r(30,"div",17)(31,"div",18),f(32,"input",19),r(33,"label",20),l(34," Cantidad de residuos reciclados (t/a\xF1o) "),i(),m(35,Zt,2,0,"div",8),i(),r(36,"div",18),f(37,"input",21),r(38,"label",22),l(39," Emisiones de GEI evitadas (t CO2eq/a\xF1o) "),i(),m(40,eo,2,0,"div",8),i()(),r(41,"div",23)(42,"button",24),l(43,"Confirmar"),i(),r(44,"button",25),v("click",function(){return w(a),F(t.onClose())}),l(45,"Cancel"),i()()()}if(o&2){let a,p,g,u,x,_,O;s(2),d("formGroup",t.dataForm),s(3),d("ngClass",C(10,fe,((a=t.dataForm.get("metodo_est"))==null?null:a.hasError("required"))&&((a=t.dataForm.get("metodo_est"))==null?null:a.touched))),s(),d("ngForOf",t.metodoEstimacionList),s(3),d("ngIf",((p=t.dataForm.get("metodo_est"))==null?null:p.hasError("required"))&&((p=t.dataForm.get("metodo_est"))==null?null:p.touched)),s(5),ye((g=t.dataForm.get("contenido"))!=null&&g.hasError("required")&&((g=t.dataForm.get("contenido"))!=null&&g.touched)?14:-1),s(15),d("ngForOf",t.residuos.controls),s(3),d("ngClass",C(12,fe,((u=t.dataForm.get("ctd_res_ceciclaods_ton"))==null?null:u.hasError("required"))&&((u=t.dataForm.get("ctd_res_ceciclaods_ton"))==null?null:u.touched))),s(3),d("ngIf",((x=t.dataForm.get("ctd_res_ceciclaods_ton"))==null?null:x.hasError("required"))&&((x=t.dataForm.get("ctd_res_ceciclaods_ton"))==null?null:x.touched)),s(2),d("ngClass",C(14,fe,((_=t.dataForm.get("emi_gei_evi"))==null?null:_.hasError("required"))&&((_=t.dataForm.get("emi_gei_evi"))==null?null:_.touched))),s(3),d("ngIf",((O=t.dataForm.get("emi_gei_evi"))==null?null:O.hasError("required"))&&((O=t.dataForm.get("emi_gei_evi"))==null?null:O.touched))}},dependencies:[me,re,de,ce,$,ne,se,W,ie,ae,le,xe,Ee,U,te,oe,z]})};var ge=n=>({"border-red-500":n});function to(n,e){if(n&1&&(r(0,"option",32),l(1),i()),n&2){let o=e.$implicit;d("value",o.value),s(),E(" ",o.name," ")}}function oo(n,e){n&1&&(r(0,"div",33),l(1," * "),i())}function io(n,e){n&1&&(r(0,"span",12),l(1,"*"),i())}function ro(n,e){n&1&&(r(0,"div",33),l(1," * "),i())}function no(n,e){if(n&1&&(r(0,"option",32),l(1),i()),n&2){let o=e.$implicit;d("value",o.value),s(),E(" ",o.name," ")}}function ao(n,e){n&1&&(r(0,"div",33),l(1," * "),i())}function lo(n,e){if(n&1&&(r(0,"option",32),l(1),i()),n&2){let o=e.$implicit;d("value",o.value),s(),E(" ",o.name," ")}}function so(n,e){n&1&&(r(0,"div",33),l(1," * "),i())}function co(n,e){if(n&1&&(r(0,"option",32),l(1),i()),n&2){let o=e.$implicit;d("value",o.value),s(),E(" ",o.name," ")}}function po(n,e){n&1&&(r(0,"div",33),l(1," * "),i())}function mo(n,e){n&1&&(r(0,"div",33),l(1," * "),i())}function uo(n,e){if(n&1){let o=R();r(0,"tr",34)(1,"td",35)(2,"div",9)(3,"select",36),v("change",function(a){let p=w(o).index,g=S();return F(g.onTipoResiduoChange(a,p))}),r(4,"option",37),l(5,"Seleccione la clase"),i(),m(6,lo,2,2,"option",6),i(),r(7,"label",38),l(8," Clase de Residuo "),i(),m(9,so,2,0,"div",8),i()(),r(10,"td",35)(11,"div",9)(12,"select",39)(13,"option",37),l(14,"Seleccione Tipo Residuo"),i(),m(15,co,2,2,"option",6),i(),r(16,"label",40),l(17," Tipo de Residuo "),i(),m(18,po,2,0,"div",8),i()(),r(19,"td",35)(20,"div",9),f(21,"input",41),r(22,"label",42),l(23,"Cantidad Residuo"),i(),m(24,mo,2,0,"div",8),i()()()}if(n&2){let o,t,a,p,g,u,x=e.index,_=S();d("formGroupName",x),s(3),d("ngClass",C(9,ge,((o=_.dataForm.get("clase"))==null?null:o.hasError("required"))&&((o=_.dataForm.get("clase"))==null?null:o.touched))),s(3),d("ngForOf",_.residuoList),s(3),d("ngIf",((t=_.dataForm.get("clase"))==null?null:t.hasError("required"))&&((t=_.dataForm.get("clase"))==null?null:t.touched)),s(3),d("ngClass",C(11,ge,((a=_.dataForm.get("fac_emi_tipo_res"))==null?null:a.hasError("required"))&&((a=_.dataForm.get("fac_emi_tipo_res"))==null?null:a.touched))),s(3),d("ngForOf",_.facEmiTipoResList[x]),s(3),d("ngIf",((p=_.dataForm.get("fac_emi_tipo_res"))==null?null:p.hasError("required"))&&((p=_.dataForm.get("fac_emi_tipo_res"))==null?null:p.touched)),s(3),d("ngClass",C(13,ge,((g=_.dataForm.get("ctd_residuo"))==null?null:g.hasError("required"))&&((g=_.dataForm.get("ctd_residuo"))==null?null:g.touched))),s(3),d("ngIf",((u=_.dataForm.get("ctd_residuo"))==null?null:u.hasError("required"))&&((u=_.dataForm.get("ctd_residuo"))==null?null:u.touched))}}function go(n,e){n&1&&(r(0,"div",33),l(1," * "),i())}function _o(n,e){n&1&&(r(0,"div",33),l(1," * "),i())}var Be=class n{constructor(e){this.fb=e;this.dataForm=this.fb.group({metodo_est:new c("",[b.required]),tipo_inv:new c("",[b.required]),patri_uni_prod:new c("",[b.required]),clase:new c(""),fac_emi_tipo_res:new c(""),ctd_residuo:new c(""),residuos:this.fb.array([]),ctd_res_ceciclaods_ton:new c({value:"",disabled:!0}),emi_gei_evi:new c({value:"",disabled:!0}),contenido:new c("",[b.required]),usuarioId:new c(0),regionId:new c(0),agenciaId:new c(0),nro_solicitud:new c(""),respaldo:new c(""),caedecId:new c(0),objetivo_operacion:new c(0),tipos_tecnologia:new c(0),metodo_estimacion:new c(0),destino_cap_inv_ope:new c(0),tipo_empresa:new c(0),ctd_empleos_gen:new c(0),monto_credito_mn:new c(0),monto_credito_me:new c(0),ctd_residuos_rec:new c(0),emision_gei_evi:new c(0)})}onCloseModalCIP=new H;dataForm;authService=h(we);fetrService=h(Se);residuoList=[];facEmiTipoResList=[];toastr=h(K);residuoService=h(Fe);ecoCirService=h(V);odsService=h(ue);ducService=h(Q);dataOds=null;regionId;agenciaId;nroSolicitud;caedecId;respaldo;objetivoOperacion;destinoCapInvOpe;tipoEmpresa;cantidadEmpleosGen;montoCreditoMn;montoCreditoMe;selectedFile=null;fileName=null;maxRows=3;metodoEstimacionList=[{value:"",name:"Seleccione estimaci\xF3n"},{value:"Considerando la capacidad de producci\xF3n",name:"Considerando la capacidad de producci\xF3n"},{value:"Considerando Incremento en el patrimonio",name:"Considerando Incremento en el patrimonio"}];otroTipoInversionList=[{value:"",name:"Seleccione inversi\xF3n"},{value:"Construcci\xF3n de plantas de reciclaje.",name:"Construcci\xF3n de plantas de reciclaje."},{value:"Mejora o ampliaci\xF3n de plantas de reciclaje.",name:"Mejora o ampliaci\xF3n de plantas de reciclaje."},{value:"Compra de terrenos",name:"Compra de terrenos"},{value:"Alquiler/anticretico de terrenos o infraestructura",name:"Alquiler/anticretico de terrenos o infraestructura"},{value:"Compra de vehiculos",name:"Compra de vehiculos"},{value:"Compra de montacargas o similares",name:"Compra de montacargas o similares"},{value:"Otros.",name:"Otros."}];get residuos(){return this.dataForm.get("residuos")}ngOnChanges(){this.authService.userId$.subscribe(e=>{this.dataForm.patchValue({usuarioId:parseInt(e[0])})})}ngOnInit(){this.initializeResiduos(),this.getResiduos(),this.subscribeResiduosChanges()}subscribeResiduosChanges(){this.dataForm.get("residuos").controls.forEach(o=>{o.get("ctd_residuo")?.valueChanges.subscribe(()=>{this.updateCtdResCeciclaodsTon()}),o.get("fac_emi_tipo_res")?.valueChanges.subscribe(()=>{this.updateCtdResCeciclaodsTon()})})}updateCtdResCeciclaodsTon(){let e=this.calculoTotalCantidad();this.dataForm.get("ctd_res_ceciclaods_ton")?.setValue(e.toFixed(0));let o=this.calculoTotal();this.dataForm.get("emi_gei_evi")?.setValue(o)}calculoTotalCantidad(){let e=this.dataForm.get("residuos"),o=0,t=0;return e.controls.forEach(a=>{let p=a.get("ctd_residuo")?.value;if(console.log(this.montoCreditoMn),p){if(parseFloat(this.dataForm.get("patri_uni_prod")?.value)<=0||this.dataForm.get("patri_uni_prod")?.value===""){this.toastr.error("Debes intorducir monto de patrimonio de unidad productiva");return}o+=Number(p)*(this.montoCreditoMn/(parseFloat(this.dataForm.get("patri_uni_prod")?.value)+this.montoCreditoMn))}}),o}calculoTotal(){let e=this.dataForm.get("residuos"),o=0;return e.controls.forEach(t=>{let a=t.get("ctd_residuo")?.value,p=t.get("fac_emi_tipo_res")?.value;a&&(o+=Number(a)*Number(p))}),o}initializeResiduos(){let e=this.dataForm.get("residuos");e.clear();for(let o=0;o<this.maxRows;o++)e.push(this.fb.group({clase:[""],fac_emi_tipo_res:[""],ctd_residuo:["",[b.min(0)]]})),this.facEmiTipoResList.push([])}getResiduos(){this.residuoService.getResiduo().subscribe({next:e=>{console.log(e),this.residuoList=e.map(o=>({value:o.id,name:o.clase}))},error:()=>{this.toastr.error("Error al cargar las subcategor\xEDas")}})}onSubmit(){if(console.log(this.dataForm.valid),console.log(this.dataForm.value),this.dataForm.valid){if(!this.validateResiduos()){this.toastr.error("Debes seleccionar al menos un residuo y asegurarte de que su cantidad sea mayor a cero.");return}this.dataForm.patchValue({regionId:this.regionId,agenciaId:this.agenciaId,nro_solicitud:this.nroSolicitud,respaldo:this.respaldo,caedecId:this.caedecId,objetivo_operacion:this.objetivoOperacion,tipos_tecnologia:this.dataForm.get("tipo_inv")?.value,metodo_estimacion:this.dataForm.get("metodo_est")?.value,destino_cap_inv_ope:this.destinoCapInvOpe,tipo_empresa:this.tipoEmpresa,ctd_empleos_gen:this.cantidadEmpleosGen,monto_credito_mn:this.montoCreditoMn,monto_credito_me:this.montoCreditoMe,ctd_residuos_rec:this.dataForm.get("ctd_res_ceciclaods_ton")?.value,emision_gei_evi:this.dataForm.get("emi_gei_evi")?.value}),console.log(this.dataForm.value),this.ecoCirService.crearEconomiaCircular(this.dataForm.value).subscribe({next:e=>{this.resetForm(),this.toastr.success("Registrado con exito!"),this.dataOds.ecoCircularId=e,console.log(this.dataOds),this.odsService.crearOds(this.dataOds).subscribe({next:()=>{this.toastr.success("ODS Registrados")}}),this.selectedFile&&this.ducService.crearDocumentoAuxCal(this.fileName,this.selectedFile,e).subscribe({next:()=>{this.toastr.success("Doc. calculos auxiliares guardados")}})},error:e=>{console.error("Error al actualizar Ecoeficiencia:",e),this.toastr.error("No se pudo registrar Ecoeficiencia. Int\xE9ntelo nuevamente m\xE1s tarde.")}})}else this.dataForm.markAllAsTouched()}onClose(){this.dataForm.reset({metodo_est:"",tipo_inv:""}),this.initializeResiduos(),this.onCloseModalCIP.emit(!1)}resetForm(){this.onClose()}onFileSelected(e){let o=e.target;if(o.files&&o.files.length>0){let t=o.files[0];if(t.type==="application/pdf"){this.fileName=t.name;let a=new FileReader;a.onload=()=>{this.selectedFile=new Blob([a.result],{type:t.type}),console.log("Archivo convertido a Blob:",this.selectedFile)},a.readAsArrayBuffer(t)}else this.fileName=null,this.dataForm.get("contenido")?.setErrors({invalidFileType:!0})}}onTipoResiduoChange(e,o){let a=+e.target.value;a?this.getFacEmiTipoRes(a,o):this.facEmiTipoResList[o]=[]}getFacEmiTipoRes(e,o){this.fetrService.getFacEmiTipoResiduo(e).subscribe({next:t=>{this.facEmiTipoResList[o]=t.map(a=>({value:a.valor,name:a.nombre}))},error:()=>{this.toastr.error("Error al cargar fac. emi tipo residuo")}})}validateResiduos(){return this.dataForm.get("residuos").controls.some(o=>{let t=o.get("ctd_residuo")?.value;return o.get("fac_emi_tipo_res")?.value&&t>0})}static \u0275fac=function(o){return new(o||n)(B(pe))};static \u0275cmp=q({type:n,selectors:[["app-capital-inversion-patrimonio"]],inputs:{dataOds:"dataOds",regionId:"regionId",agenciaId:"agenciaId",nroSolicitud:"nroSolicitud",caedecId:"caedecId",respaldo:"respaldo",objetivoOperacion:"objetivoOperacion",destinoCapInvOpe:"destinoCapInvOpe",tipoEmpresa:"tipoEmpresa",cantidadEmpleosGen:"cantidadEmpleosGen",montoCreditoMn:"montoCreditoMn",montoCreditoMe:"montoCreditoMe"},outputs:{onCloseModalCIP:"onCloseModalCIP"},standalone:!0,features:[X,k],decls:56,vars:25,consts:[["contenidoInput",""],[1,"mb-5","text-lg","font-bold","tracking-tight","text-gray-900","dark:text-white"],[1,"w-full",3,"ngSubmit","formGroup"],[1,"border","rounded-lg","p-4","bg-gray","shadow-md"],[1,"relative","mt-2","flex","items-center"],["id","metodo_est","formControlName","metodo_est","autocomplete","NA",1,"peer","mt-1","w-96","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-gray","rounded-md","text-sm",3,"ngClass"],[3,"value",4,"ngFor","ngForOf"],["for","metodo_est",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["class","absolute -right-4 text-red-500",4,"ngIf"],[1,"relative","mt-1","flex","items-center"],["for","contenido",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],[1,"mb-5","flex","items-center"],[1,"form-error","text-red-500"],["type","file","id","contenido","accept",".pdf","formControlName","contenido",1,"form-control","mr-2",3,"change"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-8"],[1,"relative","mt-6","flex","items-center"],["type","number","name","patri_uni_prod","id","patri_uni_prod","placeholder","patri_uni_prod","formControlName","patri_uni_prod","autocomplete","NA","step","0.01",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","patri_uni_prod",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["id","tipo_inv","formControlName","tipo_inv","autocomplete","NA",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-gray","rounded-md","text-sm",3,"ngClass"],["for","tipo_inv",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],[1,"min-w-full","bg-gray","border","border-gray-300"],[1,"py-2","px-4","border-b"],["formArrayName","residuos"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-4"],["type","number","name","ctd_res_ceciclaods_ton","id","ctd_res_ceciclaods_ton","placeholder","ctd_res_ceciclaods_ton","formControlName","ctd_res_ceciclaods_ton","autocomplete","NA","step","0.01",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","ctd_res_ceciclaods_ton",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["type","number","name","emi_gei_evi","id","emi_gei_evi","placeholder","emi_gei_evi","formControlName","emi_gei_evi","autocomplete","NA","step","0.01",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","emi_gei_evi",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],[1,"my-5"],["type","submit",1,"text-white","bg-blue-600","hover:bg-blue-700","font-medium","rounded-lg","w-full","sm:w-auto","px-5","py-2.5","text-center"],["type","button",1,"text-white","ms-2","bg-gray-700","hover:bg-gray-800","font-medium","rounded-lg","w-full","sm:w-auto","px-5","py-2.5","text-center",3,"click"],[3,"value"],[1,"absolute","-right-4","text-red-500"],[3,"formGroupName"],[1,"py-1","px-4","border-b"],["id","clase","formControlName","clase","autocomplete","NA",1,"peer","mt-1","w-64","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"change","ngClass"],["value","","selected",""],["for","clase",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["id","fac_emi_tipo_res","formControlName","fac_emi_tipo_res","autocomplete","NA",1,"peer","mt-1","w-64","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","fac_emi_tipo_res",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["type","number","name","ctd_residuo","id","ctd_residuo","placeholder","ctd_residuo","formControlName","ctd_residuo","autocomplete","NA","step","0.01",1,"peer","mt-1","w-64","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","ctd_residuo",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"]],template:function(o,t){if(o&1){let a=R();r(0,"h5",1),l(1," An\xE1lisis de la capacidad productiva total anual de la unidad productiva."),i(),r(2,"form",2),v("ngSubmit",function(){return w(a),F(t.onSubmit())}),r(3,"div",3)(4,"div",4)(5,"select",5),m(6,to,2,2,"option",6),i(),r(7,"label",7),l(8," Elija el metodo de estimaci\xF3n "),i(),m(9,oo,2,0,"div",8),i(),r(10,"div",9)(11,"label",10),l(12,"Adjuntar Documento de calculo aux."),i(),r(13,"div",11),m(14,io,2,0,"span",12),r(15,"input",13,0),v("change",function(g){return w(a),F(t.onFileSelected(g))}),i()()()(),r(17,"div",14)(18,"div",15),f(19,"input",16),r(20,"label",17),l(21," Patrimonio de la Unidad Productiva (Bs):"),i(),m(22,ro,2,0,"div",8),i(),r(23,"div",15)(24,"select",18),m(25,no,2,2,"option",6),i(),r(26,"label",19),l(27," Elija el Tipo de Inversi\xF3n "),i(),m(28,ao,2,0,"div",8),i()(),r(29,"table",20)(30,"thead")(31,"tr")(32,"th",21),l(33,"Clase de Residuos"),i(),r(34,"th",21),l(35,"Tipo de Residuos"),i(),r(36,"th",21),l(37,"Capacidad de procesamiento de residuos (t/a\xF1o)"),i()()(),r(38,"tbody",22),m(39,uo,25,15,"tr",23),i()(),r(40,"div",24)(41,"div",15),f(42,"input",25),r(43,"label",26),l(44," Cantidad de residuos reciclados (t/a\xF1o) "),i(),m(45,go,2,0,"div",8),i(),r(46,"div",15),f(47,"input",27),r(48,"label",28),l(49," Emisiones de GEI evitadas (t CO2eq/a\xF1o) "),i(),m(50,_o,2,0,"div",8),i()(),r(51,"div",29)(52,"button",30),l(53,"Confirmar"),i(),r(54,"button",31),v("click",function(){return w(a),F(t.onClose())}),l(55,"Cancel"),i()()()}if(o&2){let a,p,g,u,x,_,O,y,A,P,L;s(2),d("formGroup",t.dataForm),s(3),d("ngClass",C(15,ge,((a=t.dataForm.get("metodo_est"))==null?null:a.hasError("required"))&&((a=t.dataForm.get("metodo_est"))==null?null:a.touched))),s(),d("ngForOf",t.metodoEstimacionList),s(3),d("ngIf",((p=t.dataForm.get("metodo_est"))==null?null:p.hasError("required"))&&((p=t.dataForm.get("metodo_est"))==null?null:p.touched)),s(5),ye((g=t.dataForm.get("contenido"))!=null&&g.hasError("required")&&((g=t.dataForm.get("contenido"))!=null&&g.touched)?14:-1),s(5),d("ngClass",C(17,ge,((u=t.dataForm.get("patri_uni_prod"))==null?null:u.hasError("required"))&&((u=t.dataForm.get("patri_uni_prod"))==null?null:u.touched))),s(3),d("ngIf",((x=t.dataForm.get("patri_uni_prod"))==null?null:x.hasError("required"))&&((x=t.dataForm.get("patri_uni_prod"))==null?null:x.touched)),s(2),d("ngClass",C(19,ge,((_=t.dataForm.get("tipo_inv"))==null?null:_.hasError("required"))&&((_=t.dataForm.get("tipo_inv"))==null?null:_.touched))),s(),d("ngForOf",t.otroTipoInversionList),s(3),d("ngIf",((O=t.dataForm.get("tipo_inv"))==null?null:O.hasError("required"))&&((O=t.dataForm.get("tipo_inv"))==null?null:O.touched)),s(11),d("ngForOf",t.residuos.controls),s(3),d("ngClass",C(21,ge,((y=t.dataForm.get("ctd_res_ceciclaods_ton"))==null?null:y.hasError("required"))&&((y=t.dataForm.get("ctd_res_ceciclaods_ton"))==null?null:y.touched))),s(3),d("ngIf",((A=t.dataForm.get("ctd_res_ceciclaods_ton"))==null?null:A.hasError("required"))&&((A=t.dataForm.get("ctd_res_ceciclaods_ton"))==null?null:A.touched)),s(2),d("ngClass",C(23,ge,((P=t.dataForm.get("emi_gei_evi"))==null?null:P.hasError("required"))&&((P=t.dataForm.get("emi_gei_evi"))==null?null:P.touched))),s(3),d("ngIf",((L=t.dataForm.get("emi_gei_evi"))==null?null:L.hasError("required"))&&((L=t.dataForm.get("emi_gei_evi"))==null?null:L.touched))}},dependencies:[me,re,de,ce,$,ne,se,W,ie,ae,le,xe,Ee,U,te,oe,z]})};var D=n=>({"border-red-500":n});function fo(n,e){if(n&1&&(r(0,"option",80),l(1),i()),n&2){let o=e.$implicit;d("value",o.value),s(),E(" ",o.name," ")}}function ho(n,e){n&1&&(r(0,"div",81),l(1," * "),i())}function vo(n,e){if(n&1&&(r(0,"option",80),l(1),i()),n&2){let o=e.$implicit;d("value",o.value),s(),E(" ",o.name," ")}}function bo(n,e){n&1&&(r(0,"div",81),l(1," * "),i())}function Co(n,e){n&1&&(r(0,"div",81),l(1," * "),i())}function yo(n,e){n&1&&(r(0,"div",81),l(1," * "),i())}function xo(n,e){if(n&1){let o=R();r(0,"li",84),v("click",function(){let a=w(o).$implicit,p=S(2);return F(p.selectItem(a))}),l(1),i()}if(n&2){let o=e.$implicit;s(),E(" ",o.nombre," ")}}function Eo(n,e){if(n&1){let o=R();r(0,"ul",82),v("mousedown",function(){w(o);let a=S();return F(a.dropdownClicked=!0)}),m(1,xo,2,1,"li",83),i()}if(n&2){let o=S();s(),d("ngForOf",o.filteredItems)}}function wo(n,e){n&1&&(r(0,"div",81),l(1," * "),i())}function Fo(n,e){if(n&1&&(r(0,"option",80),l(1),i()),n&2){let o=e.$implicit;d("value",o.value),s(),E(" ",o.name," ")}}function So(n,e){n&1&&(r(0,"div",81),l(1," * "),i())}function Io(n,e){n&1&&(r(0,"div",81),l(1," * "),i())}function Oo(n,e){n&1&&(r(0,"div",81),l(1," * "),i())}function To(n,e){n&1&&(r(0,"div",81),l(1," * "),i())}function Mo(n,e){if(n&1&&(r(0,"option",80),l(1),i()),n&2){let o=e.$implicit;d("value",o.value),s(),E(" ",o.name," ")}}function No(n,e){n&1&&(r(0,"div",81),l(1," * "),i())}function Ro(n,e){n&1&&(r(0,"div",81),l(1," * "),i())}function Do(n,e){n&1&&(r(0,"div",81),l(1," * "),i())}function Ao(n,e){n&1&&(r(0,"div",81),l(1," * "),i())}function jo(n,e){if(n&1&&(r(0,"option",80),l(1),i()),n&2){let o=e.$implicit;d("value",o.value),s(),E(" ",o.name," ")}}function qo(n,e){n&1&&(r(0,"div",81),l(1," * "),i())}function ko(n,e){if(n&1&&(r(0,"div",85)(1,"select",86),m(2,jo,2,2,"option",6),i(),r(3,"label",87),l(4," Clase de Invesi\xF3n "),i(),m(5,qo,2,0,"div",8),i()),n&2){let o,t,a=S();s(),d("ngClass",C(3,D,((o=a.dataForm.get("clase_inv"))==null?null:o.hasError("required"))&&((o=a.dataForm.get("clase_inv"))==null?null:o.touched))),s(),d("ngForOf",a.claseInversionList),s(3),d("ngIf",((t=a.dataForm.get("clase_inv"))==null?null:t.hasError("required"))&&((t=a.dataForm.get("clase_inv"))==null?null:t.touched))}}var He=class n{constructor(e,o){this.fb=e;this.cdr=o;this.dataForm=this.fb.group({region:new c("",[b.required]),agencia:new c("",[b.required]),nro_solicitud:new c("",[b.required]),nivel_medida:new c("",[b.required]),tipo_empresa:new c({value:"",disabled:!0},[b.required]),respaldo:new c("",[b.required]),monto_inv_mn:new c("",[b.required,b.pattern(/^\d+(\.\d{1,2})?$/)]),tipo_cambio:new c(6.96,[b.required,b.pattern(/^\d+(\.\d{1,2})?$/)]),monto_inv_me:new c({value:"",disabled:!0},[b.required]),obj_ope:new c("",[b.required]),dest_cap_inv_ope:new c("",[b.required]),nro_emp_dir_gen:new c("",[b.required]),nro_emp_ind_gen:new c("",[b.required]),clase_inv:new c(""),fin_pobreza:new c(!1),hambre_cero:new c(!1),salud_bienestar:new c(!1),educacion_calidad:new c(!1),igualdad_genero:new c(!1),agua_limp_sanea:new c(!1),enr_ase_nocon:new c(!1),trab_dec_creeco:new c(!1),ind_ino_inf:new c(!1),reduc_desig:new c(!1),ciu_com_sos:new c(!1),prod_con_res:new c(!1),acc_por_cli:new c(!1),vida_sub:new c(!1),vida_eco_terr:new c(!1),paz_jus_instsol:new c(!1),ali_lograr_obj:new c(!1)})}data=null;onCloseModal=new H;dataForm;regionList=[];agenciaList=[];items=[];regService=h(Ot);toastr=h(K);ageService=h(Tt);searchTermControl=new c("");caeService=h(mt);isModalCoOpen=!1;isModalCiOpen=!1;isModalCipOpen=!1;ods;isVisible=!1;regionId;agenciaId;nroSolicitud;caedecId;respaldo;objetivoOperacion;destinoCapInvOpe;tipoEmpresa;cantidadEmpleosGen;montoCreditoMn;montoCreditoMe;respaldoList=[{value:"",name:"Seleccione respaldo"},{value:"Ficha t\xE9cnica",name:"Ficha t\xE9cnica"},{value:"Cotizaci\xF3n/Proforma",name:"Cotizaci\xF3n/Proforma"},{value:"Factura",name:"Factura"},{value:"Estudio de Factibilidad",name:"Estudio de Factibilidad"}];objetivoOperacionList=[{value:"",name:"Seleccione un objetivo"},{value:"Capital de Operaci\xF3n",name:"Capital de Operaci\xF3n"},{value:"Capital de Inversi\xF3n",name:"Capital de Inversi\xF3n"}];claseInversionList=[{value:"",name:"Seleccione clase de inv."},{value:"1",name:"MAQUINARIA PARA EL RECICLAJE Y/O APROVECHAMIENTO DE RESIDUOS"},{value:"2",name:"OTRO TIPO DE INVERSIONES PARA EL RECICLAJE Y/O APROVECHAMIENTO DE RESIDUOS"}];ngOnInit(){this.getRegiones(),this.getCaedecs(),this.dataForm.get("monto_inv_mn")?.valueChanges.subscribe(()=>this.calculateMontoInvMe()),this.dataForm.get("tipo_cambio")?.valueChanges.subscribe(()=>this.calculateMontoInvMe()),this.searchTermControl.valueChanges.subscribe(()=>{this.showDropdown=!0})}calculateMontoInvMe(){let e=this.dataForm.get("monto_inv_mn")?.value,o=this.dataForm.get("tipo_cambio")?.value;if(e&&o){let t=(e/o).toFixed(2);this.dataForm.get("monto_inv_me")?.setValue(t,{emitEvent:!1})}}getCaedecs(){this.caeService.getCaedecs().subscribe({next:e=>{this.items=e.map(o=>({nombre:`(${o.actividad}) ${o.nombre}`,actividad:o.actividad,id:o.id}))},error:()=>{this.toastr.error("Error al cargar los datos")}})}getRegiones(){this.regService.getRegion().subscribe({next:e=>{console.log(e),this.regionList=e.map(o=>({value:o.id,name:o.nombre}))},error:()=>{this.toastr.error("Error al cargar las subcategor\xEDas")}})}onRegionChange(e){let t=+e.target.value;t?this.getAgenciasRegion(t):this.agenciaList=[]}getAgenciasRegion(e){this.ageService.getAgencia(e).subscribe({next:o=>{this.agenciaList=o.map(t=>({value:t.id,name:t.nombre}))},error:()=>{this.toastr.error("Error al cargar las agencias")}})}showDropdown=!1;dropdownClicked=!1;get filteredItems(){let e=this.searchTermControl.value?.toLowerCase()??"";return e?this.items.filter(o=>o.nombre.toLowerCase().includes(e)):[]}hideDropdown(){setTimeout(()=>{this.dropdownClicked||(this.showDropdown=!1)},100)}selectItem(e){this.searchTermControl.setValue(e.nombre),this.dataForm.get("nivel_medida")?.setValue(e.nombre),this.caedecId=e.id,this.showDropdown=!1,e.actividad.trim()==="37100"||e.actividad.trim()==="37200"?this.dataForm.get("tipo_empresa")?.setValue("Empresa Recicladora"):this.dataForm.get("tipo_empresa")?.setValue("Empresa que emplea M.P. Reciclada")}onDocumentClick(e){(!e.target||!e.target.closest(".relative"))&&(this.showDropdown=!1)}onSubmit(){if(this.ods=this.dataForm.value,this.dataForm.valid){if(this.regionId=parseInt(this.dataForm.get("region")?.value),this.agenciaId=parseInt(this.dataForm.get("agencia")?.value),this.nroSolicitud=this.dataForm.get("nro_solicitud")?.value,this.respaldo=this.dataForm.get("respaldo")?.value,this.objetivoOperacion=this.dataForm.get("obj_ope")?.value,this.destinoCapInvOpe=this.dataForm.get("dest_cap_inv_ope")?.value,this.tipoEmpresa=this.dataForm.get("tipo_empresa")?.value,this.cantidadEmpleosGen=parseInt(this.dataForm.get("nro_emp_dir_gen")?.value)+parseInt(this.dataForm.get("nro_emp_ind_gen")?.value),this.montoCreditoMn=parseFloat(this.dataForm.get("monto_inv_mn")?.value),this.montoCreditoMe=parseFloat(this.dataForm.get("monto_inv_me")?.value),!["fin_pobreza","hambre_cero","salud_bienestar","educacion_calidad","igualdad_genero","agua_limp_sanea","enr_ase_nocon","trab_dec_creeco","ind_ino_inf","reduc_desig","ciu_com_sos","prod_con_res","acc_por_cli","vida_sub","vida_eco_terr","paz_jus_instsol","ali_lograr_obj"].some(t=>this.dataForm.get(t)?.value)){this.toastr.error("Debes seleccionar al menos un ODS.");return}switch(this.selectedObjOpe){case"Capital de Operaci\xF3n":this.openModalCO();break;case"Capital de Inversi\xF3n":console.log(this.dataForm.get("clase_inv")?.value),parseInt(this.dataForm.get("clase_inv")?.value)===1?this.openModalCI():(console.log("abrir modal para inverion patrimonio"),this.openModalCIP());break}}else this.dataForm.markAllAsTouched()}onClose(){this.onCloseModal.emit(!1),this.dataForm.reset({region:"",agencia:"",respaldo:"",obj_ope:""}),this.dataForm.get("tipo_cambio")?.setValue(6.96)}openModalCO(){this.isModalCoOpen=!0}closeModalCO(){this.isModalCoOpen=!1,this.onClose()}selectedObjOpe="";onObjOpeChange(e){let o=e.target;this.selectedObjOpe=o.value;let t=this.dataForm.get("clase_inv");this.selectedObjOpe==="Capital de Inversi\xF3n"?(this.isVisible=!0,this.dataForm.get("clase_inv")?.setValue(this.claseInversionList[0].value),t?.setValidators([b.required])):(this.isVisible=!1,t?.clearValidators()),t?.updateValueAndValidity(),this.cdr.detectChanges()}closeModalCI(){this.isModalCiOpen=!1,this.onClose()}openModalCI(){this.isModalCiOpen=!0}closeModalCIP(){this.isModalCipOpen=!1,this.onClose()}openModalCIP(){this.isModalCipOpen=!0}static \u0275fac=function(o){return new(o||n)(B(pe),B(at))};static \u0275cmp=q({type:n,selectors:[["app-eco-circular-create"]],hostBindings:function(o,t){o&1&&v("click",function(p){return t.onDocumentClick(p)},!1,Je)},inputs:{data:"data"},outputs:{onCloseModal:"onCloseModal"},standalone:!0,features:[k],decls:146,vars:99,consts:[[1,"mb-5","text-lg","font-bold","tracking-tight","text-gray-900","dark:text-white"],[1,"w-full",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-4"],[1,"relative","mt-1","flex","items-center"],["id","region","formControlName","region","autocomplete","NA",1,"peer","mt-1","w-96","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"change","ngClass"],["value","","selected",""],[3,"value",4,"ngFor","ngForOf"],["for","region",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["class","absolute -right-4 text-red-500",4,"ngIf"],["id","agencia","formControlName","agencia","autocomplete","NA",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","agencia",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["type","text","name","nro_solicitud","id","nro_solicitud","placeholder","nro_solicitud","formControlName","nro_solicitud","autocomplete","NA",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","nro_solicitud",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["type","text","id","nivel_medida","placeholder","Buscar caedec...","name","nivel_medida","formControlName","nivel_medida","autocomplete","off",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"focus","blur","formControl","ngClass"],["for","nivel_medida",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["class","absolute z-20 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg","style","max-height: 200px; overflow-y: auto; top: calc(100% + 4px);",3,"mousedown",4,"ngIf"],["type","text","name","tipo_empresa","id","tipo_empresa","placeholder","tipo_empresa","formControlName","tipo_empresa","autocomplete","NA",1,"peer","mt-1","w-96","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","nombre",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["id","respaldo","formControlName","respaldo","autocomplete","NA",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","respaldo",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["type","number","name","monto_inv_mn","id","monto_inv_mn","placeholder","Monto de Credito(BS)","formControlName","monto_inv_mn","autocomplete","NA","step","0.01",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","monto_inv_mn",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["type","number","name","tipo_cambio","id","tipo_cambio","placeholder","Tipo de Cambio","formControlName","tipo_cambio","autocomplete","NA","step","0.01","value","6.96",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","tipo_cambio",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["type","number","name","monto_inv_me","id","monto_inv_me","placeholder","Monto de Credito(USD)","formControlName","monto_inv_me","autocomplete","NA","step","0.01",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","monto_inv_me",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["id","obj_ope","formControlName","obj_ope","autocomplete","NA",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"change","ngClass"],["for","obj_ope",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["type","text","name","dest_cap_inv_ope","id","dest_cap_inv_ope","placeholder","dest_cap_inv_ope","formControlName","dest_cap_inv_ope","autocomplete","NA",1,"peer","mt-1","w-96","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","dest_cap_inv_ope",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["type","number","name","nro_emp_dir_gen","id","nro_emp_dir_gen","placeholder","nro_emp_dir_gen","formControlName","nro_emp_dir_gen","autocomplete","NA","step","0.01",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","nro_emp_dir_gen",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["type","number","name","","id","nro_emp_ind_gen","placeholder","nro_emp_ind_gen","formControlName","nro_emp_ind_gen","autocomplete","NA","step","0.01",1,"peer","mt-1","w-full","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","nro_emp_ind_gen",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"],["class","relative mt-1 flex items-center","id","clase_inv",4,"ngIf"],[1,"p-1","bg-gray","rounded-lg","shadow-lg","border","border-gray-300","opacity-90"],[1,"text-gray-800","mb-4"],[1,"grid","grid-cols-7","gap-2"],[1,"flex","items-center","space-x-2"],["type","checkbox","id","image-check1","formControlName","fin_pobreza",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods1.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check2","formControlName","hambre_cero",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods2.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check3","formControlName","salud_bienestar",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods3.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check4","formControlName","educacion_calidad",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods4.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check5","formControlName","igualdad_genero",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods5.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check6","formControlName","agua_limp_sanea",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods6.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check7","formControlName","enr_ase_nocon",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods7.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check8","formControlName","trab_dec_creeco",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods8.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check9","formControlName","ind_ino_inf",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods9.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check10","formControlName","reduc_desig",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods10.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check11","formControlName","ciu_com_sos",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods11.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check12","formControlName","prod_con_res",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods12.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check13","formControlName","acc_por_cli",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods13.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check14","formControlName","vida_sub",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods14.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check15","formControlName","vida_eco_terr",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods15.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check16","formControlName","paz_jus_instsol",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods16.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],["type","checkbox","id","image-check17","formControlName","ali_lograr_obj",1,"h-4","w-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],["src","assets/ods17.png","alt","Descripci\xF3n de la imagen",1,"h-12","w-12","object-cover","rounded-lg","shadow-lg","opacity-75"],[1,"my-5"],["type","submit",1,"text-white","bg-blue-600","hover:bg-blue-700","font-medium","rounded-lg","w-full","sm:w-auto","px-5","py-2.5","text-center"],["type","button",1,"text-white","ms-2","bg-gray-700","hover:bg-gray-800","font-medium","rounded-lg","w-full","sm:w-auto","px-5","py-2.5","text-center",3,"click"],[3,"closeModal","isOpen"],[3,"onCloseModalCO","dataOds","regionId","agenciaId","nroSolicitud","caedecId","respaldo","objetivoOperacion","destinoCapInvOpe","tipoEmpresa","cantidadEmpleosGen","montoCreditoMn","montoCreditoMe"],[3,"onCloseModalCI","dataOds","regionId","agenciaId","nroSolicitud","caedecId","respaldo","objetivoOperacion","destinoCapInvOpe","tipoEmpresa","cantidadEmpleosGen","montoCreditoMn","montoCreditoMe"],[3,"onCloseModalCIP","dataOds","regionId","agenciaId","nroSolicitud","caedecId","respaldo","objetivoOperacion","destinoCapInvOpe","tipoEmpresa","cantidadEmpleosGen","montoCreditoMn","montoCreditoMe"],[3,"value"],[1,"absolute","-right-4","text-red-500"],[1,"absolute","z-20","mt-1","w-full","bg-white","border","border-gray-300","rounded-lg","shadow-lg",2,"max-height","200px","overflow-y","auto","top","calc(100% + 4px)",3,"mousedown"],["class","p-2 border-b border-gray-200 cursor-pointer hover:bg-gray-100",3,"click",4,"ngFor","ngForOf"],[1,"p-2","border-b","border-gray-200","cursor-pointer","hover:bg-gray-100",3,"click"],["id","clase_inv",1,"relative","mt-1","flex","items-center"],["id","clase_inv","formControlName","clase_inv","autocomplete","NA",1,"peer","mt-1","w-96","border-b-2","border-gray-300","px-2","py-1.5","bg-gray-100","placeholder:text-transparent","focus:border-gray-500","focus:outline-none","focus:bg-white","rounded-md","text-sm",3,"ngClass"],["for","clase_inv",1,"pointer-events-none","absolute","top-0","left-0","origin-left","-translate-y-1/2","transform","text-sm","text-gray-800","opacity-75","transition-all","duration-100","ease-in-out","peer-placeholder-shown:top-1/2","peer-placeholder-shown:text-base","peer-placeholder-shown:text-gray-500","peer-focus:top-0","peer-focus:pl-0","peer-focus:text-sm","peer-focus:text-gray-800"]],template:function(o,t){if(o&1&&(r(0,"h5",0),l(1,"Ingresar datos Proyecto Circular"),i(),r(2,"form",1),v("ngSubmit",function(){return t.onSubmit()}),r(3,"div",2)(4,"div",3)(5,"select",4),v("change",function(p){return t.onRegionChange(p)}),r(6,"option",5),l(7,"Seleccione la region"),i(),m(8,fo,2,2,"option",6),i(),r(9,"label",7),l(10," Regi\xF3n "),i(),m(11,ho,2,0,"div",8),i(),r(12,"div",3)(13,"select",9)(14,"option",5),l(15,"Seleccione la agencia"),i(),m(16,vo,2,2,"option",6),i(),r(17,"label",10),l(18," Agencia "),i(),m(19,bo,2,0,"div",8),i(),r(20,"div",3),f(21,"input",11),r(22,"label",12),l(23," Nro solicitud"),i(),m(24,Co,2,0,"div",8),i(),r(25,"div",3)(26,"input",13),v("focus",function(){return t.showDropdown=!0})("blur",function(){return t.hideDropdown()}),i(),r(27,"label",14),l(28," Buscar caedec..."),i(),m(29,yo,2,0,"div",8)(30,Eo,2,1,"ul",15),i()(),r(31,"div",2)(32,"div",3),f(33,"input",16),r(34,"label",17),l(35," Tipo Empresa"),i(),m(36,wo,2,0,"div",8),i(),r(37,"div",3)(38,"select",18),m(39,Fo,2,2,"option",6),i(),r(40,"label",19),l(41," Respaldo "),i(),m(42,So,2,0,"div",8),i(),r(43,"div",3),f(44,"input",20),r(45,"label",21),l(46,"Monto de Credito(BS)"),i(),m(47,Io,2,0,"div",8),i(),r(48,"div",3),f(49,"input",22),r(50,"label",23),l(51,"Tipo de Cambio"),i(),m(52,Oo,2,0,"div",8),i(),r(53,"div",3),f(54,"input",24),r(55,"label",25),l(56,"Monto de Credito(USD)"),i(),m(57,To,2,0,"div",8),i(),r(58,"div",3)(59,"select",26),v("change",function(p){return t.onObjOpeChange(p)}),m(60,Mo,2,2,"option",6),i(),r(61,"label",27),l(62," Objetivo de la Operaci\xF3n (KO/KI) "),i(),m(63,No,2,0,"div",8),i(),r(64,"div",3),f(65,"input",28),r(66,"label",29),l(67," Destino de Capital de Inversion y/o Operaci\xF3n"),i(),m(68,Ro,2,0,"div",8),i(),r(69,"div",3),f(70,"input",30),r(71,"label",31),l(72," Nro Empleos Directos Generados"),i(),m(73,Do,2,0,"div",8),i(),r(74,"div",3),f(75,"input",32),r(76,"label",33),l(77," Nro Empleos Indirectos Generados"),i(),m(78,Ao,2,0,"div",8),i(),m(79,ko,6,5,"div",34),i(),r(80,"div",35)(81,"h2",36),l(82,"Objetivos de Desarrollo Sostenible (ODS) a los que aporta"),i(),r(83,"div",37)(84,"div",38),f(85,"input",39)(86,"img",40),i(),r(87,"div",38),f(88,"input",41)(89,"img",42),i(),r(90,"div",38),f(91,"input",43)(92,"img",44),i(),r(93,"div",38),f(94,"input",45)(95,"img",46),i(),r(96,"div",38),f(97,"input",47)(98,"img",48),i(),r(99,"div",38),f(100,"input",49)(101,"img",50),i(),r(102,"div",38),f(103,"input",51)(104,"img",52),i(),r(105,"div",38),f(106,"input",53)(107,"img",54),i(),r(108,"div",38),f(109,"input",55)(110,"img",56),i(),r(111,"div",38),f(112,"input",57)(113,"img",58),i(),r(114,"div",38),f(115,"input",59)(116,"img",60),i(),r(117,"div",38),f(118,"input",61)(119,"img",62),i(),r(120,"div",38),f(121,"input",63)(122,"img",64),i(),r(123,"div",38),f(124,"input",65)(125,"img",66),i(),r(126,"div",38),f(127,"input",67)(128,"img",68),i(),r(129,"div",38),f(130,"input",69)(131,"img",70),i(),r(132,"div",38),f(133,"input",71)(134,"img",72),i()()(),r(135,"div",73)(136,"button",74),l(137,"Siguiente"),i(),r(138,"button",75),v("click",function(){return t.onClose()}),l(139,"Cancel"),i()()(),r(140,"app-modal",76),v("closeModal",function(){return t.closeModalCO()}),r(141,"app-capital-operacion",77),v("onCloseModalCO",function(){return t.closeModalCO()}),i()(),r(142,"app-modal",76),v("closeModal",function(){return t.closeModalCI()}),r(143,"app-capital-inversion",78),v("onCloseModalCI",function(){return t.closeModalCI()}),i()(),r(144,"app-modal",76),v("closeModal",function(){return t.closeModalCIP()}),r(145,"app-capital-inversion-patrimonio",79),v("onCloseModalCIP",function(){return t.closeModalCIP()}),i()()),o&2){let a,p,g,u,x,_,O,y,A,P,L,he,T,j,I,M,N,G,J,Y,ve,be,Ce,Te,Me,Ne;s(2),d("formGroup",t.dataForm),s(3),d("ngClass",C(73,D,((a=t.dataForm.get("region"))==null?null:a.hasError("required"))&&((a=t.dataForm.get("region"))==null?null:a.touched))),s(3),d("ngForOf",t.regionList),s(3),d("ngIf",((p=t.dataForm.get("region"))==null?null:p.hasError("required"))&&((p=t.dataForm.get("region"))==null?null:p.touched)),s(2),d("ngClass",C(75,D,((g=t.dataForm.get("agencia"))==null?null:g.hasError("required"))&&((g=t.dataForm.get("agencia"))==null?null:g.touched))),s(3),d("ngForOf",t.agenciaList),s(3),d("ngIf",((u=t.dataForm.get("agencia"))==null?null:u.hasError("required"))&&((u=t.dataForm.get("agencia"))==null?null:u.touched)),s(2),d("ngClass",C(77,D,((x=t.dataForm.get("nro_solicitud"))==null?null:x.hasError("required"))&&((x=t.dataForm.get("nro_solicitud"))==null?null:x.touched))),s(3),d("ngIf",((_=t.dataForm.get("nro_solicitud"))==null?null:_.hasError("required"))&&((_=t.dataForm.get("nro_solicitud"))==null?null:_.touched)),s(2),d("formControl",t.searchTermControl)("ngClass",C(79,D,((O=t.dataForm.get("nivel_medida"))==null?null:O.hasError("required"))&&((O=t.dataForm.get("nivel_medida"))==null?null:O.touched))),s(3),d("ngIf",((y=t.dataForm.get("nivel_medida"))==null?null:y.hasError("required"))&&((y=t.dataForm.get("nivel_medida"))==null?null:y.touched)),s(),d("ngIf",t.showDropdown&&t.filteredItems.length>0),s(3),d("ngClass",C(81,D,((A=t.dataForm.get("tipo_empresa"))==null?null:A.hasError("required"))&&((A=t.dataForm.get("tipo_empresa"))==null?null:A.touched))),s(3),d("ngIf",((P=t.dataForm.get("tipo_empresa"))==null?null:P.hasError("required"))&&((P=t.dataForm.get("tipo_empresa"))==null?null:P.touched)),s(2),d("ngClass",C(83,D,((L=t.dataForm.get("respaldo"))==null?null:L.hasError("required"))&&((L=t.dataForm.get("respaldo"))==null?null:L.touched))),s(),d("ngForOf",t.respaldoList),s(3),d("ngIf",((he=t.dataForm.get("respaldo"))==null?null:he.hasError("required"))&&((he=t.dataForm.get("respaldo"))==null?null:he.touched)),s(2),d("ngClass",C(85,D,((T=t.dataForm.get("monto_inv_mn"))==null?null:T.hasError("required"))&&((T=t.dataForm.get("monto_inv_mn"))==null?null:T.touched))),s(3),d("ngIf",((j=t.dataForm.get("monto_inv_mn"))==null?null:j.hasError("required"))&&((j=t.dataForm.get("monto_inv_mn"))==null?null:j.touched)),s(2),d("ngClass",C(87,D,((I=t.dataForm.get("tipo_cambio"))==null?null:I.hasError("required"))&&((I=t.dataForm.get("tipo_cambio"))==null?null:I.touched))),s(3),d("ngIf",((M=t.dataForm.get("tipo_cambio"))==null?null:M.hasError("required"))&&((M=t.dataForm.get("tipo_cambio"))==null?null:M.touched)),s(2),d("ngClass",C(89,D,((N=t.dataForm.get("monto_inv_me"))==null?null:N.hasError("required"))&&((N=t.dataForm.get("monto_inv_me"))==null?null:N.touched))),s(3),d("ngIf",((G=t.dataForm.get("monto_inv_me"))==null?null:G.hasError("required"))&&((G=t.dataForm.get("monto_inv_me"))==null?null:G.touched)),s(2),d("ngClass",C(91,D,((J=t.dataForm.get("obj_ope"))==null?null:J.hasError("required"))&&((J=t.dataForm.get("obj_ope"))==null?null:J.touched))),s(),d("ngForOf",t.objetivoOperacionList),s(3),d("ngIf",((Y=t.dataForm.get("obj_ope"))==null?null:Y.hasError("required"))&&((Y=t.dataForm.get("obj_ope"))==null?null:Y.touched)),s(2),d("ngClass",C(93,D,((ve=t.dataForm.get("dest_cap_inv_ope"))==null?null:ve.hasError("required"))&&((ve=t.dataForm.get("dest_cap_inv_ope"))==null?null:ve.touched))),s(3),d("ngIf",((be=t.dataForm.get("dest_cap_inv_ope"))==null?null:be.hasError("required"))&&((be=t.dataForm.get("dest_cap_inv_ope"))==null?null:be.touched)),s(2),d("ngClass",C(95,D,((Ce=t.dataForm.get("nro_emp_dir_gen"))==null?null:Ce.hasError("required"))&&((Ce=t.dataForm.get("nro_emp_dir_gen"))==null?null:Ce.touched))),s(3),d("ngIf",((Te=t.dataForm.get("nro_emp_dir_gen"))==null?null:Te.hasError("required"))&&((Te=t.dataForm.get("nro_emp_dir_gen"))==null?null:Te.touched)),s(2),d("ngClass",C(97,D,((Me=t.dataForm.get("nro_emp_ind_gen"))==null?null:Me.hasError("required"))&&((Me=t.dataForm.get("nro_emp_ind_gen"))==null?null:Me.touched))),s(3),d("ngIf",((Ne=t.dataForm.get("nro_emp_ind_gen"))==null?null:Ne.hasError("required"))&&((Ne=t.dataForm.get("nro_emp_ind_gen"))==null?null:Ne.touched)),s(),d("ngIf",t.isVisible),s(61),d("isOpen",t.isModalCoOpen),s(),d("dataOds",t.ods)("regionId",t.regionId)("agenciaId",t.agenciaId)("nroSolicitud",t.nroSolicitud)("caedecId",t.caedecId)("respaldo",t.respaldo)("objetivoOperacion",t.objetivoOperacion)("destinoCapInvOpe",t.destinoCapInvOpe)("tipoEmpresa",t.tipoEmpresa)("cantidadEmpleosGen",t.cantidadEmpleosGen)("montoCreditoMn",t.montoCreditoMn)("montoCreditoMe",t.montoCreditoMe),s(),d("isOpen",t.isModalCiOpen),s(),d("dataOds",t.ods)("regionId",t.regionId)("agenciaId",t.agenciaId)("nroSolicitud",t.nroSolicitud)("caedecId",t.caedecId)("respaldo",t.respaldo)("objetivoOperacion",t.objetivoOperacion)("destinoCapInvOpe",t.destinoCapInvOpe)("tipoEmpresa",t.tipoEmpresa)("cantidadEmpleosGen",t.cantidadEmpleosGen)("montoCreditoMn",t.montoCreditoMn)("montoCreditoMe",t.montoCreditoMe),s(),d("isOpen",t.isModalCipOpen),s(),d("dataOds",t.ods)("regionId",t.regionId)("agenciaId",t.agenciaId)("nroSolicitud",t.nroSolicitud)("caedecId",t.caedecId)("respaldo",t.respaldo)("objetivoOperacion",t.objetivoOperacion)("destinoCapInvOpe",t.destinoCapInvOpe)("tipoEmpresa",t.tipoEmpresa)("cantidadEmpleosGen",t.cantidadEmpleosGen)("montoCreditoMn",t.montoCreditoMn)("montoCreditoMe",t.montoCreditoMe)}},dependencies:[me,re,de,ce,$,ne,st,se,W,ie,ct,ae,le,U,te,oe,z,qe,Ve,Ge,Be]})};function Vo(n,e){if(n&1&&f(0,"iframe",5),n&2){let o=S(2);d("src",o.pdfSrc,We)}}function Po(n,e){if(n&1&&f(0,"iframe",5),n&2){let o=S(2);d("src",o.pdfUrl,We)}}function Lo(n,e){if(n&1){let o=R();r(0,"div",1),m(1,Vo,1,1,"iframe",2)(2,Po,1,1,"iframe",2),r(3,"div",3)(4,"button",4),v("click",function(){w(o);let a=S();return F(a.downloadPdf())}),l(5,"Descargar PDF"),i(),r(6,"button",4),v("click",function(){w(o);let a=S();return F(a.closeModal())}),l(7,"Cerrar"),i()()()}if(n&2){let o=S();s(),d("ngIf",o.pdfSrc),s(),d("ngIf",o.pdfUrl)}}var ze=class n{constructor(e){this.sanitizer=e}onCloseDocModal=new H;ecoCircularId=null;ecoCirServices=h(V);odsServices=h(ue);datePipe=h(Ke);dataSet;dataSetDocAux;dataSetOds=[];pdfSrc=null;pdfBlobUrl=null;ducService=h(Q);pdfUrl;pdfUrld;ngOnChanges(){console.log(this.ecoCircularId),this.ecoCircularId&&(this.getEcoCircularById(this.ecoCircularId),this.getOdsById(this.ecoCircularId),this.getDocumentoAuxCal(this.ecoCircularId))}getDocumentoAuxCal(e){this.ducService.getDocumentoAuxCal(e).subscribe({next:o=>{console.log(o),this.dataSetDocAux=o,this.dataSetDocAux[0].contenidoB64&&this.createPdfUrl()}})}createPdfUrl(){let e=this.dataSetDocAux[0].contenidoB64.startsWith("data:application/pdf;base64,")?this.dataSetDocAux[0].contenidoB64:`data:application/pdf;base64,${this.dataSetDocAux[0].contenidoB64}`;this.pdfUrl=this.sanitizer.bypassSecurityTrustResourceUrl(e)}getOdsById(e){this.odsServices.getCircularOds(e).subscribe({next:o=>{this.dataSetOds=o.map(t=>({imagen:t.imagen,descripcion:t.descripcion}))},error:o=>{console.error("Error al obtener ods:",o)}})}getEcoCircularById(e){this.ecoCirServices.getEcoCircularById(e).subscribe({next:o=>{this.dataSet=o,this.dataSet.fecha_registro_formatted=this.formatFechaRegistro(this.dataSet.fecha_registro),this.dataSet?this.generatePdf():console.log("No hay datos para generar el PDF")},error:o=>{console.error("Error al obtener ecoeficiencia:",o)}})}formatFechaRegistro(e){if(!e)return null;let o=new Date(e);return this.datePipe.transform(o,"dd/MM/yyyy")}generatePdf(){if(!this.dataSet){console.log(this.dataSet);return}let e=new Mt({orientation:"p",unit:"mm",format:[210,297]}),o="assets/bdp.png",t=new Image;t.src=o,Promise.all([new Promise(a=>{t.onload=a})]).then(()=>{e.addImage(t,"PNG",165,6,20,20),e.setFontSize(10);let a=["Formulaci\xF3n de Validaci\xF3n de Proyectos","Medici\xF3n Econom\xEDa Circular","Reporte Final"],p=10,g=e.internal.pageSize.getWidth();a.forEach((T,j)=>{let I=e.getTextWidth(T),M=(g-I)/2,N=5+j*5;e.text(T,M,N+6),e.setFont("Helvetica","bold")}),e.setFont("Helvetica","normal");let u=30;e.setFont("Helvetica","bold"),e.text("1 Informaci\xF3n General",p,u),e.setFont("Helvetica","normal"),u+=3,[{label:"Insttuci\xF3n Financiera:",value:"Banco de Desarrollo Productivo S.A.M."},{label:"Regi\xF3n:",value:this.dataSet?.region.nombreRegion},{label:"Agencia:",value:this.dataSet?.agencium?.nombreAgencia},{label:"Analista:",value:this.dataSet?.usuario?.nombre_completo},{label:"Fecha de Reporte:",value:this.dataSet.fecha_registro_formatted}].forEach(T=>{let I=(g-2*p)/2,M=(g-2*p)/2;e.rect(p,u,I,6),e.rect(p+I,u,M,6),e.text(T.label,p+2,u+5);let N=(T.value??"n/a").toString(),G=e.getTextWidth(N),J=p+I+(M-G)/2;e.text(N,J,u+5),u+=6}),u+=10,e.setFont("Helvetica","bold"),e.text("2 Informaci\xF3n del Cliente",p,u),e.setFont("Helvetica","normal"),u+=3,[{label:"Caedec - C\xF3digo Subcteg :",value:this.dataSet?.caedec?.actividad},{label:"Caedec - Descripcion Subcteg :",value:this.dataSet?.caedec?.nombreCaedec},{label:"Nro Solicitud:",value:this.dataSet?.nro_solicitud},{label:"Objetivo de la Operaci\xF3n (KO/KI):",value:this.dataSet?.objetivo_operacion},{label:"Destino del capital de inversi\xF3n y/o Operaci\xF3n:",value:this.dataSet?.destino_cap_inv_ope},{label:"Tipo de empresa:",value:this.dataSet?.tipo_empresa}].forEach(T=>{let I=(g-2*p)/2,M=(g-2*p)/2,N=(T.value??"n/a").toString(),G=e.splitTextToSize(N,M),Y=6*G.length;e.rect(p,u,I,Y),e.rect(p+I,u,M,Y),e.text(T.label,p+2,u+5);let ve=p+I+2;G.forEach((be,Ce)=>{e.text(be,ve,u+5+Ce*4)}),u+=Y}),u+=10,e.setFont("Helvetica","bold"),e.text("4 Informaci\xF3n del Proyecto",p,u),e.setFont("Helvetica","normal"),u+=3,[{label:"Monto del cr\xE9dito (Bs.)",value:this.formatNumero(this.dataSet?.monto_credito_mn)},{label:"Respaldo de inversi\xF3n elegible:",value:this.dataSet?.respaldo},{label:"Objetivo de la Operaci\xF3n (KO/KI):",value:this.dataSet?.objetivo_operacion},{label:"Destino del capital de inversi\xF3n y/o Operaci\xF3n:",value:this.dataSet?.destino_cap_inv_ope},{label:"Cantidad de residuos reciclados (t)",value:this.dataSet?.ctd_residuos_rec},{label:"Emisiones de GEI evitadas (t CO2eq):",value:this.formatNumero(this.dataSet?.emision_gei_evi)},{label:"Cantidad de empleos generados:",value:this.dataSet?.ctd_empleos_gen}].forEach(T=>{let I=(g-2*p)/2,M=(g-2*p)/2;e.rect(p,u,I,6),e.rect(p+I,u,M,6),e.text(T.label,p+2,u+5);let N=(T.value??"n/a").toString(),G=e.getTextWidth(N),J=p+I+(M-G)/2;e.text(N,J,u+5),u+=6}),u+=10,e.setFontSize(10),e.setFont("Helvetica","bold"),e.text("Objetivos de Desarrollo Sostenible (ODS) a los que aporta :",p,u),u+=5;let y=10,A=10,P=2,L=Math.max(A,10);this.dataSetOds.forEach((T,j)=>{let I=p+j%3*(y+P+55),M=Math.floor(j/3)*(L+1);e.addImage(T.imagen,"PNG",I,u+M,y,A),e.setFontSize(8),e.setFont("Helvetica","normal");let N=I+y+1;e.text(T.descripcion,N,u+M+A/2)});let he=e.output("blob");this.pdfBlobUrl&&URL.revokeObjectURL(this.pdfBlobUrl),this.pdfBlobUrl=URL.createObjectURL(he),this.pdfUrld=this.sanitizer.bypassSecurityTrustResourceUrl(this.pdfBlobUrl),this.pdfSrc=this.pdfUrld})}downloadPdf(){if(this.pdfBlobUrl){let e=document.createElement("a");e.href=this.pdfBlobUrl,e.download="reporte-ecoeficiencia.pdf",e.click()}}closeModal(){this.onCloseDocModal.emit(),this.dataSet=null}ngOnDestroy(){this.pdfBlobUrl&&URL.revokeObjectURL(this.pdfBlobUrl)}formatNumero(e){if(e===null)return"n/a";let o=e.toString().split("."),t=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,"."),a=o[1]?","+o[1]:"";return t+a}static \u0275fac=function(o){return new(o||n)(B(lt))};static \u0275cmp=q({type:n,selectors:[["app-eco-circular-reporte"]],inputs:{ecoCircularId:"ecoCircularId"},outputs:{onCloseDocModal:"onCloseDocModal"},standalone:!0,features:[rt([Ke]),X,k],decls:1,vars:1,consts:[["class","pdf-container",4,"ngIf"],[1,"pdf-container"],["width","900","height","400",3,"src",4,"ngIf"],[1,"pdf-controls"],[3,"click"],["width","900","height","400",3,"src"]],template:function(o,t){o&1&&m(0,Lo,8,2,"div",0),o&2&&d("ngIf",t.pdfSrc)},dependencies:[Nt,U,z],styles:['@charset "UTF-8";.pdf-container[_ngcontent-%COMP%]{width:900px;height:800px;overflow:auto;position:relative}pdf-viewer[_ngcontent-%COMP%]{width:80%;height:80%;background:#fff;border:1px solid #ccc}.pdf-controls[_ngcontent-%COMP%]{position:absolute;bottom:10px;right:10px;display:flex;gap:10px}.pdf-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 20px;font-size:16px;color:#fff;background-color:#007bff;border:none;border-radius:5px;cursor:pointer}.pdf-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#0056b3}']})};var Go=()=>[5,10,25,100];function Bo(n,e){n&1&&(r(0,"th",29),l(1," Id "),i())}function Ho(n,e){if(n&1&&(r(0,"td",30),l(1),i()),n&2){let o=e.$implicit;s(),E(" ",o.id," ")}}function zo(n,e){n&1&&(r(0,"th",29),l(1," Nro Solicitud "),i())}function Uo(n,e){if(n&1&&(r(0,"td",30),l(1),i()),n&2){let o=e.$implicit;s(),E(" ",o.nro_solicitud," ")}}function $o(n,e){n&1&&(r(0,"th",29),l(1," Respaldo "),i())}function Wo(n,e){if(n&1&&(r(0,"td",30),l(1),i()),n&2){let o=e.$implicit;s(),E(" ",o.respaldo," ")}}function Ko(n,e){n&1&&(r(0,"th",29),l(1," Objetivo Operacion "),i())}function Qo(n,e){if(n&1&&(r(0,"td",30),l(1),i()),n&2){let o=e.$implicit;s(),E(" ",o.objetivo_operacion," ")}}function Jo(n,e){n&1&&(r(0,"th",29),l(1," Cantidad residuos reciclados "),i())}function Yo(n,e){if(n&1&&(r(0,"td",30),l(1),i()),n&2){let o=e.$implicit;s(),E(" ",o.ctd_residuos_rec," ")}}function Xo(n,e){n&1&&(r(0,"th",29),l(1," Emision gei evitados"),i())}function Zo(n,e){if(n&1&&(r(0,"td",30),l(1),i()),n&2){let o=e.$implicit;s(),E(" ",o.emision_gei_evi," ")}}function ei(n,e){n&1&&(r(0,"th",29),l(1," Opciones "),i())}function ti(n,e){if(n&1){let o=R();r(0,"td",30)(1,"div",31)(2,"div",32)(3,"button",33),v("click",function(){let a=w(o).$implicit,p=S();return F(p.openModalDoc(a.id))}),r(4,"i",34),Ue(),r(5,"svg",35),f(6,"path",36)(7,"polyline",37),i(),$e(),r(8,"span",38),l(9," Ver Doc. "),i()()()(),r(10,"div",39)(11,"button",40),v("click",function(){let a=w(o).$implicit,p=S();return F(p.deleteCircular(a.id))}),r(12,"i",34),Ue(),r(13,"svg",41),f(14,"path",42)(15,"line",43)(16,"line",44)(17,"line",45)(18,"path",46)(19,"path",47),i(),$e(),r(20,"span",38),l(21," Eliminar "),i()()()()()()}}function oi(n,e){n&1&&f(0,"tr",48)}function ii(n,e){n&1&&f(0,"tr",49)}var Qe=class n{displayedColumns=["id","nro_solicitud","respaldo","objetivo_operacion","ctd_residuos_rec","emision_gei_evi","actions"];dataSource=new wt([]);paginator;filterId="";toastr=h(K);ecoCirService=h(V);ecoCircularId;isModalOpen=!1;isModalDocOpen=!1;Circular;applyFilter(){this.dataSource.filterPredicate=(e,o)=>{let[t]=o.trim().split(";");return t?e.id.toString().toLowerCase().includes(t):!0}}ngOnInit(){this.getEconomiaCircular()}ngAfterViewInit(){this.dataSource.paginator=this.paginator}getEconomiaCircular(){this.ecoCirService.getEconomiaCircular().subscribe({next:e=>{this.dataSource.data=e,this.applyFilter()},error:()=>{this.toastr.error("Error al cargar los datos")}})}openModal(){this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.getEconomiaCircular()}openModalDoc(e){console.log(e),this.ecoCircularId=e,this.isModalDocOpen=!0}closeModalDoc(){this.isModalDocOpen=!1}deleteCircular(e){this.ecoCirService.eliminaEcoCircular(e).subscribe({next:()=>{this.toastr.success("Registro de Circular Eliminado"),this.getEconomiaCircular()}})}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=q({type:n,selectors:[["app-eco-circular"]],viewQuery:function(o,t){if(o&1&&Xe(ke,5),o&2){let a;Ze(a=et())&&(t.paginator=a.first)}},standalone:!0,features:[k],decls:45,vars:10,consts:[[1,"py-1"],[1,"mx-auto","sm:px-6","lg:px-8","mb-6"],[1,"mx-4","pb-6","text-3xl","font-bold","text-gray-800"],[1,"border-t-4","border-t-indigo-500","-mt-4","ml-5","w-64"],[1,"mx-auto","sm:px-6","lg:px-8"],[1,"bg-white","overflow-hidden","shadow-xl","sm:rounded-lg","px-4","py-4","dark:bg-gray-800/50","dark:bg-gradient-to-bl"],[1,"flex","items-center","justify-between","dark:text-gray-400","m-4"],[1,"space-x-8","mb-2"],["type","button",1,"focus:ring-2","focus:ring-offset-2","focus:ring-blue-600","mt-4","sm:mt-0","inline-flex","items-start","justify-start","px-6","py-3","bg-blue-500","hover:bg-blue-600","focus:outline-none","rounded",3,"click"],[1,"text-sm","font-medium","leading-none","text-white"],[1,"flex","space-x-4"],["matInput","","placeholder","Filtro por ID",3,"ngModelChange","ngModel"],[1,"shadow","overflow-hidden","border-b","border-gray-200","sm:rounded-lg"],["mat-table","",1,"no-border-table","w-full","divide-y","divide-gray-200","table-auto",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nro_solicitud"],["matColumnDef","respaldo"],["matColumnDef","objetivo_operacion"],["matColumnDef","ctd_residuos_rec"],["matColumnDef","emision_gei_evi"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","","aria-label","Seleccionar p\xE1gina",3,"pageSizeOptions"],[3,"closeModal","isOpen"],[3,"onCloseModal","data"],[3,"onCloseDocModal","ecoCircularId"],["mat-header-cell",""],["mat-cell",""],[1,"flex","items-center","space-x-2"],[1,"group","relative","inline-block","whitespace-nowrap"],[1,"bg-stone-700","w-8","h-8","rounded-full","hover:bg-stone-500","flex","items-center","justify-center","ml-2",3,"click"],[1,"text-white"],["viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"h-5","w-5","text-white-500"],["d","M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"],["points","13 2 13 9 20 9"],["role","tooltip",1,"pointer-events-none","absolute","z-50","inline-flex","items-center","justify-center","rounded-md","px-3","py-1","font-semibold","opacity-0","transition-opacity","duration-300","ease-in-out","group-hover:opacity-100","bg-stone-50","text-stone-700","min-h-7","text-sm","left-1/2","-translate-x-1/2","after:absolute","after:block","after:size-0","after:border-8","after:border-transparent","after:border-t-stone-50","after:-bottom-[0.95rem]","after:left-1/2","after:-translate-x-1/2","top-[-2.5rem]"],[1,"group","relative"],[1,"bg-red-600","w-8","h-8","rounded-full","hover:bg-red-400","flex","items-center","justify-center",3,"click"],["width","4","height","4","viewBox","0 0 24 24","stroke-width","2","stroke","currentColor","fill","none","stroke-linecap","round","stroke-linejoin","round",1,"h-5","w-5","text-white-500"],["stroke","none","d","M0 0h24v24H0z"],["x1","4","y1","7","x2","20","y2","7"],["x1","10","y1","11","x2","10","y2","17"],["x1","14","y1","11","x2","14","y2","17"],["d","M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"],["d","M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"],["mat-header-row",""],["mat-row",""]],template:function(o,t){o&1&&(r(0,"div",0)(1,"div",1)(2,"h2",2),l(3," Economia Circular "),i(),f(4,"div",3),i(),r(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7)(9,"button",8),v("click",function(){return t.openModal()}),r(10,"p",9),l(11," Iniciar"),i()()()(),r(12,"div",10)(13,"input",11),it("ngModelChange",function(p){return ot(t.filterId,p)||(t.filterId=p),p}),v("ngModelChange",function(){return t.applyFilter()}),i()(),r(14,"div",12)(15,"table",13),Z(16,14),m(17,Bo,2,0,"th",15)(18,Ho,2,1,"td",16),ee(),Z(19,17),m(20,zo,2,0,"th",15)(21,Uo,2,1,"td",16),ee(),l(22,"respaldo "),Z(23,18),m(24,$o,2,0,"th",15)(25,Wo,2,1,"td",16),ee(),Z(26,19),m(27,Ko,2,0,"th",15)(28,Qo,2,1,"td",16),ee(),Z(29,20),m(30,Jo,2,0,"th",15)(31,Yo,2,1,"td",16),ee(),Z(32,21),m(33,Xo,2,0,"th",15)(34,Zo,2,1,"td",16),ee(),Z(35,22),m(36,ei,2,0,"th",15)(37,ti,22,0,"td",16),ee(),m(38,oi,1,0,"tr",23)(39,ii,1,0,"tr",24),i(),f(40,"mat-paginator",25),i()()()(),r(41,"app-modal",26),v("closeModal",function(){return t.closeModal()}),r(42,"app-eco-circular-create",27),v("onCloseModal",function(){return t.closeModal()}),i()(),r(43,"app-modal",26),v("closeModal",function(){return t.closeModalDoc()}),r(44,"app-eco-circular-reporte",28),v("onCloseDocModal",function(){return t.closeModalDoc()}),i()()),o&2&&(s(13),tt("ngModel",t.filterId),s(2),d("dataSource",t.dataSource),s(23),d("matHeaderRowDef",t.displayedColumns),s(),d("matRowDefColumns",t.displayedColumns),s(),d("pageSizeOptions",nt(9,Go)),s(),d("isOpen",t.isModalOpen),s(),d("data",t.Circular),s(),d("isOpen",t.isModalDocOpen),s(),d("ecoCircularId",t.ecoCircularId))},dependencies:[qe,He,Ft,ke,Et,ut,_t,bt,ft,gt,Ct,ht,vt,yt,xt,It,St,pt,$,W,dt,ze]})};export{Qe as default};
